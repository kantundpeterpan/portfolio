<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Practical - Logistic regression in R â€“ Heiner Atze, PhD</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="chd.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-the-data-and-inspect" id="toc-load-the-data-and-inspect" class="nav-link active" data-scroll-target="#load-the-data-and-inspect">Load the data and inspect</a>
  <ul class="collapse">
  <li><a href="#plot-age-vs.-target" id="toc-plot-age-vs.-target" class="nav-link" data-scroll-target="#plot-age-vs.-target">Plot age vs.&nbsp;target</a></li>
  </ul></li>
  <li><a href="#model-with-age-as-continous-variable" id="toc-model-with-age-as-continous-variable" class="nav-link" data-scroll-target="#model-with-age-as-continous-variable">Model with <code>age</code> as continous variable</a>
  <ul class="collapse">
  <li><a href="#fit-and-model-summary" id="toc-fit-and-model-summary" class="nav-link" data-scroll-target="#fit-and-model-summary">Fit and model summary</a></li>
  <li><a href="#predicted-outcome-by-age" id="toc-predicted-outcome-by-age" class="nav-link" data-scroll-target="#predicted-outcome-by-age">Predicted outcome by age</a></li>
  <li><a href="#visualisation" id="toc-visualisation" class="nav-link" data-scroll-target="#visualisation">Visualisation</a></li>
  </ul></li>
  <li><a href="#model-equation-linear-generalization" id="toc-model-equation-linear-generalization" class="nav-link" data-scroll-target="#model-equation-linear-generalization">Model equation, linear generalization</a></li>
  <li><a href="#interpretation-of-the-model-output" id="toc-interpretation-of-the-model-output" class="nav-link" data-scroll-target="#interpretation-of-the-model-output">Interpretation of the model output</a></li>
  <li><a href="#interpretation-of-model-coefficients" id="toc-interpretation-of-model-coefficients" class="nav-link" data-scroll-target="#interpretation-of-model-coefficients">Interpretation of model coefficients</a>
  <ul class="collapse">
  <li><a href="#general-case" id="toc-general-case" class="nav-link" data-scroll-target="#general-case">General case</a></li>
  <li><a href="#depending-on-the-type-of-x-eb-gives-odds-ratios" id="toc-depending-on-the-type-of-x-eb-gives-odds-ratios" class="nav-link" data-scroll-target="#depending-on-the-type-of-x-eb-gives-odds-ratios">Depending on the type of <span class="math inline">\(X\)</span>, <span class="math inline">\(e^b\)</span> gives odds ratios</a>
  <ul class="collapse">
  <li><a href="#quantitative-x" id="toc-quantitative-x" class="nav-link" data-scroll-target="#quantitative-x">Quantitative <span class="math inline">\(X\)</span></a></li>
  <li><a href="#binary-x" id="toc-binary-x" class="nav-link" data-scroll-target="#binary-x">Binary <span class="math inline">\(X\)</span></a></li>
  <li><a href="#categorical-x" id="toc-categorical-x" class="nav-link" data-scroll-target="#categorical-x">Categorical X</a></li>
  </ul></li>
  <li><a href="#derivation-of-ebeta-or" id="toc-derivation-of-ebeta-or" class="nav-link" data-scroll-target="#derivation-of-ebeta-or">Derivation of <span class="math inline">\(e^\beta = OR\)</span></a></li>
  </ul></li>
  <li><a href="#multiple-logistic-regression" id="toc-multiple-logistic-regression" class="nav-link" data-scroll-target="#multiple-logistic-regression">Multiple logistic regression</a>
  <ul class="collapse">
  <li><a href="#model-structure" id="toc-model-structure" class="nav-link" data-scroll-target="#model-structure">Model structure</a></li>
  <li><a href="#case-study---low-birthweight-dataset" id="toc-case-study---low-birthweight-dataset" class="nav-link" data-scroll-target="#case-study---low-birthweight-dataset">Case study - Low birthweight dataset</a>
  <ul class="collapse">
  <li><a href="#data-prep" id="toc-data-prep" class="nav-link" data-scroll-target="#data-prep">Data prep</a></li>
  <li><a href="#data-exploration-and-toy-model" id="toc-data-exploration-and-toy-model" class="nav-link" data-scroll-target="#data-exploration-and-toy-model">Data exploration and toy model</a></li>
  <li><a href="#toy-model-equation" id="toc-toy-model-equation" class="nav-link" data-scroll-target="#toy-model-equation">Toy model equation</a></li>
  <li><a href="#calculation-and-intepretation-of-or_smoke" id="toc-calculation-and-intepretation-of-or_smoke" class="nav-link" data-scroll-target="#calculation-and-intepretation-of-or_smoke">Calculation and Intepretation of <span class="math inline">\(OR_{smoke}\)</span></a></li>
  <li><a href="#calculation-of-or_race3race2-by-hand" id="toc-calculation-of-or_race3race2-by-hand" class="nav-link" data-scroll-target="#calculation-of-or_race3race2-by-hand">Calculation of <span class="math inline">\(OR_{race3/race2}\)</span> by hand</a></li>
  <li><a href="#calculation-of-or_race3race2-in-r" id="toc-calculation-of-or_race3race2-in-r" class="nav-link" data-scroll-target="#calculation-of-or_race3race2-in-r">Calculation of <span class="math inline">\(OR_{race3/race2}\)</span> in R</a></li>
  <li><a href="#ors-with-their-confidence-intervals" id="toc-ors-with-their-confidence-intervals" class="nav-link" data-scroll-target="#ors-with-their-confidence-intervals"><span class="math inline">\(ORs\)</span> with their confidence intervals</a></li>
  </ul></li>
  <li><a href="#checking-for-confounding" id="toc-checking-for-confounding" class="nav-link" data-scroll-target="#checking-for-confounding">Checking for Confounding</a>
  <ul class="collapse">
  <li><a href="#conceputally" id="toc-conceputally" class="nav-link" data-scroll-target="#conceputally">Conceputally</a></li>
  <li><a href="#in-r" id="toc-in-r" class="nav-link" data-scroll-target="#in-r">In R</a></li>
  </ul></li>
  <li><a href="#mediating-variables" id="toc-mediating-variables" class="nav-link" data-scroll-target="#mediating-variables">Mediating variables</a>
  <ul class="collapse">
  <li><a href="#concepts" id="toc-concepts" class="nav-link" data-scroll-target="#concepts">Concepts</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  <li><a href="#likelihood-ratio-test-lrt" id="toc-likelihood-ratio-test-lrt" class="nav-link" data-scroll-target="#likelihood-ratio-test-lrt">Likelihood-Ratio-Test (LRT)</a>
  <ul class="collapse">
  <li><a href="#nested-models" id="toc-nested-models" class="nav-link" data-scroll-target="#nested-models">Nested models</a></li>
  <li><a href="#overall-model-significance" id="toc-overall-model-significance" class="nav-link" data-scroll-target="#overall-model-significance">Overall model significance</a></li>
  </ul></li>
  <li><a href="#effect-modification-and-interaction" id="toc-effect-modification-and-interaction" class="nav-link" data-scroll-target="#effect-modification-and-interaction">Effect modification and Interaction</a>
  <ul class="collapse">
  <li><a href="#concepts-1" id="toc-concepts-1" class="nav-link" data-scroll-target="#concepts-1">Concepts</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example</a></li>
  </ul></li>
  <li><a href="#model-assumptions" id="toc-model-assumptions" class="nav-link" data-scroll-target="#model-assumptions">Model assumptions</a>
  <ul class="collapse">
  <li><a href="#linearity-check" id="toc-linearity-check" class="nav-link" data-scroll-target="#linearity-check">Linearity check</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Practical - Logistic regression in R</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"equatiomatic"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-the-data-and-inspect" class="level1 page-columns page-full">
<h1>Load the data and inspect</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>chd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/amayomode/Heart-Disease-Risk-Prediction/master/Heart%20Disease%20Prediction/data/framingham.csv'</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#binning age variable</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>chd<span class="sc">$</span>AgeCat <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cut</span>(chd<span class="sc">$</span>age, <span class="at">breaks=</span><span class="dv">8</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(chd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      male             age          education     currentSmoker   
 Min.   :0.0000   Min.   :32.00   Min.   :1.000   Min.   :0.0000  
 1st Qu.:0.0000   1st Qu.:42.00   1st Qu.:1.000   1st Qu.:0.0000  
 Median :0.0000   Median :49.00   Median :2.000   Median :0.0000  
 Mean   :0.4292   Mean   :49.58   Mean   :1.979   Mean   :0.4941  
 3rd Qu.:1.0000   3rd Qu.:56.00   3rd Qu.:3.000   3rd Qu.:1.0000  
 Max.   :1.0000   Max.   :70.00   Max.   :4.000   Max.   :1.0000  
                                  NA's   :105                     
   cigsPerDay         BPMeds        prevalentStroke     prevalentHyp   
 Min.   : 0.000   Min.   :0.00000   Min.   :0.000000   Min.   :0.0000  
 1st Qu.: 0.000   1st Qu.:0.00000   1st Qu.:0.000000   1st Qu.:0.0000  
 Median : 0.000   Median :0.00000   Median :0.000000   Median :0.0000  
 Mean   : 9.006   Mean   :0.02962   Mean   :0.005896   Mean   :0.3106  
 3rd Qu.:20.000   3rd Qu.:0.00000   3rd Qu.:0.000000   3rd Qu.:1.0000  
 Max.   :70.000   Max.   :1.00000   Max.   :1.000000   Max.   :1.0000  
 NA's   :29       NA's   :53                                           
    diabetes          totChol          sysBP           diaBP      
 Min.   :0.00000   Min.   :107.0   Min.   : 83.5   Min.   : 48.0  
 1st Qu.:0.00000   1st Qu.:206.0   1st Qu.:117.0   1st Qu.: 75.0  
 Median :0.00000   Median :234.0   Median :128.0   Median : 82.0  
 Mean   :0.02571   Mean   :236.7   Mean   :132.4   Mean   : 82.9  
 3rd Qu.:0.00000   3rd Qu.:263.0   3rd Qu.:144.0   3rd Qu.: 90.0  
 Max.   :1.00000   Max.   :696.0   Max.   :295.0   Max.   :142.5  
                   NA's   :50                                     
      BMI          heartRate         glucose         TenYearCHD    
 Min.   :15.54   Min.   : 44.00   Min.   : 40.00   Min.   :0.0000  
 1st Qu.:23.07   1st Qu.: 68.00   1st Qu.: 71.00   1st Qu.:0.0000  
 Median :25.40   Median : 75.00   Median : 78.00   Median :0.0000  
 Mean   :25.80   Mean   : 75.88   Mean   : 81.96   Mean   :0.1519  
 3rd Qu.:28.04   3rd Qu.: 83.00   3rd Qu.: 87.00   3rd Qu.:0.0000  
 Max.   :56.80   Max.   :143.00   Max.   :394.00   Max.   :1.0000  
 NA's   :19      NA's   :1        NA's   :388                      
         AgeCat   
 (41.5,46.2]:849  
 (36.8,41.5]:772  
 (46.2,51]  :732  
 (55.8,60.5]:593  
 (51,55.8]  :565  
 (60.5,65.2]:469  
 (Other)    :260  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(chd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="plot-age-vs.-target" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="plot-age-vs.-target">Plot age vs.&nbsp;target</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(chd, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> TenYearCHD)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>pp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mean_age_healthy <span class="ot">&lt;-</span> <span class="fu">mean</span>(age[TenYearCHD<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mean_age_chd <span class="ot">&lt;-</span> <span class="fu">mean</span>(age[TenYearCHD<span class="sc">==</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mean age healthy subjects: 48.76</p>
<p>Mean age diseased subjects: 54.15</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>interval_midpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(s){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  midpoint <span class="ot">&lt;-</span> <span class="fu">substring</span>(s, <span class="dv">2</span>, <span class="fu">str_length</span>(s)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">","</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(as.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (midpoint)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>interval_ul <span class="ot">&lt;-</span> <span class="cf">function</span>(s){</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  ul <span class="ot">&lt;-</span> <span class="fu">substring</span>(s, <span class="dv">2</span>, <span class="fu">str_length</span>(s)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">","</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(as.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.vector</span>()</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (ul[<span class="dv">2</span>])</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>p_per_age <span class="ot">&lt;-</span> chd <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(AgeCat) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">mean</span>(TenYearCHD))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>p_per_age<span class="sc">$</span>midpoint <span class="ot">&lt;-</span> <span class="fu">sapply</span>(p_per_age<span class="sc">$</span>AgeCat, interval_midpoint)  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>p_per_age<span class="sc">$</span>ul <span class="ot">&lt;-</span> <span class="fu">sapply</span>(p_per_age<span class="sc">$</span>AgeCat, interval_ul)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pp <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span>p), <span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> p_per_age, <span class="fu">aes</span>(<span class="at">xintercept=</span>ul))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Probability of CHD per age category (red dots), upper limit of age category (veritcal lines)</figcaption>
</figure>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span>p)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span><span class="fu">log</span>(p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)))) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell column-body quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</section>
</section>
<section id="model-with-age-as-continous-variable" class="level1 page-columns page-full">
<h1>Model with <code>age</code> as continous variable</h1>
<section id="fit-and-model-summary" class="level2">
<h2 class="anchored" data-anchor-id="fit-and-model-summary">Fit and model summary</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(TenYearCHD <span class="sc">~</span> age, <span class="at">data=</span>chd, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = TenYearCHD ~ age, family = "binomial", data = chd)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.0386  -0.6261  -0.4580  -0.3695   2.4493  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -5.561090   0.283746  -19.60   &lt;2e-16 ***
age          0.074650   0.005265   14.18   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3612.2  on 4239  degrees of freedom
Residual deviance: 3396.6  on 4238  degrees of freedom
AIC: 3400.6

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
</section>
<section id="predicted-outcome-by-age" class="level2">
<h2 class="anchored" data-anchor-id="predicted-outcome-by-age">Predicted outcome by age</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict.glm</span>(model, <span class="at">type=</span><span class="fu">c</span>(<span class="st">'response'</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sm_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">spline</span>(chd<span class="sc">$</span>age, pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualisation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="visualisation">Visualisation</h2>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pp <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span>p), <span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> sm_pred, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Model fitted values of P(Y=1|X)'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span><span class="fu">log</span>(p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)))) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">fortify</span>(model), <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Model fitted values of the link function'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell column-body quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</section>
</section>
<section id="model-equation-linear-generalization" class="level1">
<h1>Model equation, linear generalization</h1>
<p><span class="math inline">\(Y\)</span>: binary outcome, coded as <span class="math inline">\(0/1\)</span> (<em>e.g.</em> diseased, non-diseased)</p>
<p><span class="math inline">\(X\)</span>: explanatory variable</p>
<p><span class="math inline">\(\hat p = P(Y=1 | X)\)</span> cannot be modeled with a linear function of the form <span class="math inline">\(\hat p = b_0+b_1X\)</span>, as it is not appropiately bounded in <span class="math inline">\(\left[0,1\right]\)</span>. One suitable function to model <span class="math inline">\(\hat p\)</span> is :</p>
<p><span class="math display">\[\hat p = \frac{e^{b_0+b_1X}}{1+e^{b_0+b_1X}}\]</span></p>
<p>From this equation follows, that :</p>
<p><span class="math display">\[\operatorname{Logit}\left(\hat p\right) =\ln \left(\frac{\hat p}{1-\hat p}\right) = b_0+b_1X\]</span></p>
<p>The <span class="math inline">\(log-odds\)</span> of <span class="math inline">\(\hat p = P(Y=1|X)\)</span> is a linear function of <span class="math inline">\(X\)</span>. From the odds of <span class="math inline">\(Y=1\)</span>, <span class="math inline">\(P(Y=1|X)\)</span> can be calculated - <span class="math inline">\(\operatorname{Logit}\)</span> is called link function in Logistic regression.</p>
</section>
<section id="interpretation-of-the-model-output" class="level1">
<h1>Interpretation of the model output</h1>
<p>The model provides the following estimation:</p>
<p><span class="math display">\[\hat p = \frac{e^{-5.561 + 0.075 \times age}}{1+e^{-5.561 + 0.075 \times age}}\]</span></p>
<p>Example for a subject with <span class="math inline">\(age=32\)</span>:</p>
<p><span class="math display">\[P(Y=1 | X=32) = \frac{e^{-5.561 + 0.075 \times 32}}{1+e^{-5.561 + 0.075 \times 32}} = 0.04\]</span></p>
</section>
<section id="interpretation-of-model-coefficients" class="level1 page-columns page-full">
<h1>Interpretation of model coefficients</h1>
<section id="general-case" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="general-case">General case</h2>
<p><span class="math display">\[\ln \left(\frac{\hat p}{1-\hat p}\right) = b_0+b_1X\]</span></p>

<div class="no-row-height column-margin column-container"><div class="">
<p><span class="math inline">\(\ln \left(\frac{\hat p}{1-\hat p}\right)\)</span>: <span class="math inline">\(\text{log-odds of }Y=1\)</span></p>
<p><span class="math inline">\(b_0\)</span>: log-odds of <span class="math inline">\(Y=1\)</span> <span class="math inline">\(\forall X: X=0 / ref\)</span></p>
<p><span class="math inline">\(b_1\)</span>: <span class="math inline">\(\Delta\)</span> in log-odds wrt to <span class="math inline">\(\Delta X\)</span></p>
</div></div></section>
<section id="depending-on-the-type-of-x-eb-gives-odds-ratios" class="level2">
<h2 class="anchored" data-anchor-id="depending-on-the-type-of-x-eb-gives-odds-ratios">Depending on the type of <span class="math inline">\(X\)</span>, <span class="math inline">\(e^b\)</span> gives odds ratios</h2>
<section id="quantitative-x" class="level3">
<h3 class="anchored" data-anchor-id="quantitative-x">Quantitative <span class="math inline">\(X\)</span></h3>
<div class="columns">
<div class="column">
<p><span class="math inline">\(b_1\)</span>: <span class="math inline">\(\Delta\)</span> in log-odds for a one unit increase in <span class="math inline">\(X\)</span></p>
</div><div class="column">
<p><span class="math inline">\(e^b\)</span> gives incremental inrease in <span class="math inline">\(OR\)</span> with a one unit increase of <span class="math inline">\(X\)</span></p>
</div>
</div>
</section>
<section id="binary-x" class="level3">
<h3 class="anchored" data-anchor-id="binary-x">Binary <span class="math inline">\(X\)</span></h3>
<div class="columns">
<div class="column">
<p><span class="math inline">\(b_1\)</span>: <span class="math inline">\(\Delta\)</span> in log-odds for <span class="math inline">\(X=1\)</span> relative to <span class="math inline">\(X=0\)</span></p>
</div><div class="column">
<p><span class="math inline">\(e^{b_1} = OR_{Y=1, \frac{X=1}{X=0}}\)</span></p>
</div>
</div>
</section>
<section id="categorical-x" class="level3">
<h3 class="anchored" data-anchor-id="categorical-x">Categorical X</h3>
<p><span class="math inline">\(X \in \{A, B, C\}\)</span>, <span class="math inline">\(b_A\)</span> is absorbed into reference</p>
<div class="columns">
<div class="column">
<p><span class="math inline">\(b_B\)</span>: <span class="math inline">\(\Delta\)</span> in log-odds for <span class="math inline">\(X = B\)</span></p>
<p><span class="math inline">\(\vdots\)</span></p>
</div><div class="column">
<p><span class="math inline">\(e^{b_B} = OR_{Y=1, \frac{X=B}{X=A}}\)</span></p>
</div>
</div>
</section>
</section>
<section id="derivation-of-ebeta-or" class="level2">
<h2 class="anchored" data-anchor-id="derivation-of-ebeta-or">Derivation of <span class="math inline">\(e^\beta = OR\)</span></h2>
<p>Consider a one-unit increase in <span class="math inline">\(X\)</span> <span class="math display">\[\ln \left(\frac{\hat p}{1-\hat p}\right) = b_0+b_1X\]</span></p>
<p><span class="math display">\[
\begin{align}
\ln OR &amp;= \ln \left(\frac{\operatorname{Logit}(Y=1, X=a+1)}{\operatorname{Logit}(Y=1, X=a)}\right) \\
\ln OR &amp;= \ln \left[\operatorname{Logit}(Y=1, X=a+1)\right] - \ln \left[\operatorname{Logit}(Y=1, X=a)\right] \\
       &amp;= \left[b_0+b_1\times (a+1)\right] - \left[b_0+b_1\times a \right] \\
\ln OR &amp;= b_1 \\
    OR &amp;= e^{b_1}
\end{align}
\]</span></p>
</section>
</section>
<section id="multiple-logistic-regression" class="level1">
<h1>Multiple logistic regression</h1>
<section id="model-structure" class="level2">
<h2 class="anchored" data-anchor-id="model-structure">Model structure</h2>
<p><span class="math inline">\(Y\)</span>: binary outcome, coded as <span class="math inline">\(0/1\)</span> (<em>e.g.</em> diseased, non-diseased)</p>
<p><span class="math inline">\(X\)</span>: explanatory variables, vector</p>
<p><span class="math inline">\(\beta\)</span>: coefficient vector</p>
<p><span class="math inline">\(\beta_0\)</span>: intercept</p>
<p>As for simple logistic regression, <span class="math inline">\(\hat p = P(Y=1 | X_1, X_2, \ldots, X_i)\)</span> cannot be modeled with a linear function of the form <span class="math inline">\(\hat p = \beta_0+X \beta\)</span>, as it is not appropiately bounded in <span class="math inline">\(\left[0,1\right]\)</span>. One suitable function to model <span class="math inline">\(\hat p\)</span> is :</p>
<p><span class="math display">\[\hat p = \frac{e^{\beta+X\beta}}{1+e^{\beta_0+X\beta}}\]</span></p>
<p>From this equation follows, that :</p>
<p><span class="math display">\[\operatorname{Logit}\left(\hat p\right) =\ln \left(\frac{\hat p}{1-\hat p}\right) = \beta_0+X \beta\]</span></p>
</section>
<section id="case-study---low-birthweight-dataset" class="level2">
<h2 class="anchored" data-anchor-id="case-study---low-birthweight-dataset">Case study - Low birthweight dataset</h2>
<section id="data-prep" class="level3">
<h3 class="anchored" data-anchor-id="data-prep">Data prep</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lbw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/SarthakDubey/CUDA-Logistic-Regression/master/lowbwt.csv'</span>) <span class="sc">%&gt;%</span> <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(ID))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lbw) <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">names</span>(lbw), str_to_lower)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># deriving lwd variable</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>lbw<span class="sc">$</span>lwd <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(lbw<span class="sc">$</span>lwt <span class="sc">&lt;</span> <span class="dv">110</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># releveling ptl</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>lbw<span class="sc">$</span>ptl <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(lbw<span class="sc">$</span>ptl <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (varname <span class="cf">in</span> <span class="fu">c</span>(<span class="st">'lwd'</span>, <span class="st">'race'</span>, <span class="st">'smoke'</span>, <span class="st">'ht'</span>, <span class="st">'ui'</span>, <span class="st">'ptl'</span>)){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  lbw[,varname] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">unlist</span>(lbw[,varname]))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lbw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "smoke" "low"   "age"   "lwt"   "race"  "ptl"   "ht"    "ui"    "ftv"  
[10] "bwt"   "lwd"  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> smoke        low              age             lwt        race   ptl    
 0:115   Min.   :0.0000   Min.   :14.00   Min.   : 80.0   1:96   0:159  
 1: 74   1st Qu.:0.0000   1st Qu.:19.00   1st Qu.:110.0   2:26   1: 30  
         Median :0.0000   Median :23.00   Median :121.0   3:67          
         Mean   :0.3122   Mean   :23.24   Mean   :129.8                 
         3rd Qu.:1.0000   3rd Qu.:26.00   3rd Qu.:140.0                 
         Max.   :1.0000   Max.   :45.00   Max.   :250.0                 
 ht      ui           ftv              bwt       lwd    
 0:177   0:161   Min.   :0.0000   Min.   : 709   0:147  
 1: 12   1: 28   1st Qu.:0.0000   1st Qu.:2414   1: 42  
                 Median :0.0000   Median :2977          
                 Mean   :0.7937   Mean   :2945          
                 3rd Qu.:1.0000   3rd Qu.:3475          
                 Max.   :6.0000   Max.   :4990          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(lbw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-exploration-and-toy-model" class="level3">
<h3 class="anchored" data-anchor-id="data-exploration-and-toy-model">Data exploration and toy model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(low)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>low
  0   1 
130  59 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(low))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>low
        0         1 
0.6878307 0.3121693 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sake.of.discussion <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> lwt,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sake.of.discussion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = low ~ smoke + age + race + lwt, family = "binomial")

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.5173  -0.9065  -0.5865   1.3035   2.0401  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept)  0.332452   1.107672   0.300  0.76407   
smoke1       1.054439   0.380000   2.775  0.00552 **
age         -0.022478   0.034170  -0.658  0.51065   
race2        1.231671   0.517152   2.382  0.01724 * 
race3        0.943263   0.416232   2.266  0.02344 * 
lwt         -0.012526   0.006386  -1.961  0.04982 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 234.67  on 188  degrees of freedom
Residual deviance: 214.58  on 183  degrees of freedom
AIC: 226.58

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
<section id="toy-model-equation" class="level3">
<h3 class="anchored" data-anchor-id="toy-model-equation">Toy model equation</h3>
<p><span class="math display">\[\ln \left(\frac{\hat p}{1-\hat p}\right) = 0.332 + 1.054\times smoke - 0.022 \times age + 1.232 \times black + 0.943 \times other - 0.013 \times lwt\]</span></p>
<p>Prediction for a 35-year old, white, smoker with <span class="math inline">\(lwt=135\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>to_pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age=</span><span class="dv">35</span>, <span class="at">smoke =</span> <span class="fu">as.factor</span>(<span class="dv">1</span>), <span class="at">race=</span><span class="fu">as.factor</span>(<span class="dv">1</span>), <span class="at">lwt=</span><span class="dv">135</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">predict</span>(sake.of.discussion, to_pred, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">'response'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[\hat p = 0.251\]</span></p>
</section>
<section id="calculation-and-intepretation-of-or_smoke" class="level3">
<h3 class="anchored" data-anchor-id="calculation-and-intepretation-of-or_smoke">Calculation and Intepretation of <span class="math inline">\(OR_{smoke}\)</span></h3>
<p><span class="math display">\[OR_{smoke} = e^{1.054} = 2.87\]</span></p>
<p>The odds of low birthweight for a mother who smoked during pregnancy are 2.87 the odds of low birthweight for a mother who did not smoke during pregnancy.</p>
</section>
<section id="calculation-of-or_race3race2-by-hand" class="level3">
<h3 class="anchored" data-anchor-id="calculation-of-or_race3race2-by-hand">Calculation of <span class="math inline">\(OR_{race3/race2}\)</span> by hand</h3>
<p><span class="math display">\[OR_{race3/race2} = \frac{OR_{race3/ref}}{OR_{race2/ref}}\]</span></p>
</section>
<section id="calculation-of-or_race3race2-in-r" class="level3">
<h3 class="anchored" data-anchor-id="calculation-of-or_race3race2-in-r">Calculation of <span class="math inline">\(OR_{race3/race2}\)</span> in R</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(race)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>race
 1  2  3 
96 26 67 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>race.new <span class="ot">&lt;-</span> <span class="fu">relevel</span>(race, <span class="at">ref =</span> <span class="dv">3</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(race.new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>race.new
 3  1  2 
67 96 26 </code></pre>
</div>
</div>
<p>Reparameterized model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>model.re <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> age <span class="sc">+</span> race.new <span class="sc">+</span> lwt,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(model.re))                          </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)      smoke1         age   race.new1   race.new2         lwt 
  3.5812583   2.8703634   0.9777725   0.3893554   1.3343025   0.9875525 </code></pre>
</div>
</div>
</section>
<section id="ors-with-their-confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="ors-with-their-confidence-intervals"><span class="math inline">\(ORs\)</span> with their confidence intervals</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ors <span class="ot">&lt;-</span> <span class="fu">exp</span>(sake.of.discussion<span class="sc">$</span>coefficients)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cits <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(sake.of.discussion))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(ors, cits) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">ors</th>
<th style="text-align: right;">2.5 %</th>
<th style="text-align: right;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">1.39</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">12.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoke1</td>
<td style="text-align: right;">2.87</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">6.19</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: right;">1.04</td>
</tr>
<tr class="even">
<td style="text-align: left;">race2</td>
<td style="text-align: right;">3.43</td>
<td style="text-align: right;">1.25</td>
<td style="text-align: right;">9.63</td>
</tr>
<tr class="odd">
<td style="text-align: left;">race3</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">1.15</td>
<td style="text-align: right;">5.94</td>
</tr>
<tr class="even">
<td style="text-align: left;">lwt</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="checking-for-confounding" class="level2">
<h2 class="anchored" data-anchor-id="checking-for-confounding">Checking for Confounding</h2>
<section id="conceputally" class="level3">
<h3 class="anchored" data-anchor-id="conceputally">Conceputally</h3>
<ul>
<li>Criteria for a confounding variable <span class="math inline">\(F\)</span>
<ul>
<li>Do the following associations conceptually make sense ?
<ol type="1">
<li>Is <span class="math inline">\(F\)</span> associated with <span class="math inline">\(E\)</span> ? Is <span class="math inline">\(F\)</span> NOT on the pathway <span class="math inline">\(E \rightarrow Y\)</span>?</li>
<li>Is <span class="math inline">\(F\)</span> associated with <span class="math inline">\(Y\)</span> ?</li>
</ol></li>
<li>Does including <span class="math inline">\(F\)</span> significantly change <span class="math inline">\(b_1\)</span> while not inflating <span class="math inline">\(\sigma_b\)</span> ?</li>
</ul></li>
</ul>
<p><span class="math inline">\(Q\)</span>: Does <code>race</code> confound the effect of <code>smoke</code> on low birthweight?</p>
<div class="cell" data-fig-width="2" data-fig-height="2" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="192" height="192" viewbox="0.00 0.00 152.25 116.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 112)">
<title>P</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-112 148.25,-112 148.25,4 -4,4"></polygon>
<!-- smoke -->
<g id="node1" class="node">
<title>smoke</title>
<ellipse fill="none" stroke="black" cx="36.25" cy="-18" rx="36.5" ry="18"></ellipse>
<text text-anchor="middle" x="36.25" y="-13.8" font-family="Times,serif" font-size="14.00">smoke</text>
</g>
<!-- low -->
<g id="node2" class="node">
<title>low</title>
<ellipse fill="none" stroke="black" cx="117.25" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="117.25" y="-13.8" font-family="Times,serif" font-size="14.00">low</text>
</g>
<!-- smoke&#45;&gt;low -->
<g id="edge1" class="edge">
<title>smoke-&gt;low</title>
<path fill="none" stroke="black" d="M72.64,-18C75.09,-18 77.54,-18 79.99,-18"></path>
<polygon fill="black" stroke="black" points="80.06,-21.5 90.06,-18 80.06,-14.5 80.06,-21.5"></polygon>
</g>
<!-- race -->
<g id="node3" class="node">
<title>race</title>
<ellipse fill="none" stroke="black" cx="76.25" cy="-90" rx="27.22" ry="18"></ellipse>
<text text-anchor="middle" x="76.25" y="-85.8" font-family="Times,serif" font-size="14.00">race</text>
</g>
<!-- race&#45;&gt;smoke -->
<g id="edge2" class="edge">
<title>race-&gt;smoke</title>
<path fill="none" stroke="black" d="M66.97,-72.76C62.19,-64.4 56.26,-54.02 50.88,-44.61"></path>
<polygon fill="black" stroke="black" points="53.75,-42.58 45.75,-35.63 47.68,-46.05 53.75,-42.58"></polygon>
</g>
<!-- race&#45;&gt;low -->
<g id="edge3" class="edge">
<title>race-&gt;low</title>
<path fill="none" stroke="black" d="M85.76,-72.76C90.78,-64.19 97.05,-53.49 102.66,-43.9"></path>
<polygon fill="black" stroke="black" points="105.76,-45.55 107.79,-35.15 99.72,-42.01 105.76,-45.55"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>Application to <span class="math inline">\(Q\)</span>
<ol type="1">
<li>seeing <code>race</code> as a proxy for culture, association with <code>smoke</code> seems at least possible, <code>race</code> is certainly not on the causal pathway <code>smoke</code> <span class="math inline">\(\rightarrow\)</span> <code>low</code></li>
<li></li>
</ol></li>
</ul>
</section>
<section id="in-r" class="level3">
<h3 class="anchored" data-anchor-id="in-r">In R</h3>
<section id="check-association-between-race-and-smoke" class="level4">
<h4 class="anchored" data-anchor-id="check-association-between-race-and-smoke">Check association between <code>race</code> and <code>smoke</code></h4>
<ul>
<li>Plot</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">table</span>(race, smoke))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Proportion table</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(race, smoke), <span class="at">margin =</span> <span class="st">'race'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    smoke
race     0     1
   1 0.458 0.542
   2 0.615 0.385
   3 0.821 0.179</code></pre>
</div>
</div>
<ul>
<li><span class="math inline">\(\chi^2\)</span> test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(race, smoke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  race and smoke
X-squared = 21.779, df = 2, p-value = 1.865e-05</code></pre>
</div>
</div>
<ul>
<li>Univariate logistic model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>conf_mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(smoke <span class="sc">~</span> race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(conf_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = smoke ~ race, family = "binomial")

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.2491  -0.9854  -0.6283   1.1073   1.8546  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   0.1671     0.2048   0.816    0.415    
race2        -0.6371     0.4522  -1.409    0.159    
race3        -1.6895     0.3788  -4.460 8.18e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 253.04  on 188  degrees of freedom
Residual deviance: 230.05  on 186  degrees of freedom
AIC: 236.05

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">confint</span>(conf_mod)),<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            2.5 % 97.5 %
(Intercept) 0.792  1.772
race2       0.212  1.267
race3       0.085  0.378</code></pre>
</div>
</div>
</section>
<section id="check-association-between-race-and-low" class="level4">
<h4 class="anchored" data-anchor-id="check-association-between-race-and-low">Check association between <code>race</code> and <code>low</code></h4>
<ul>
<li>Plot</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">table</span>(race, low))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Proportion table</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(race, low), <span class="at">margin =</span> <span class="st">'race'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    low
race     0     1
   1 0.760 0.240
   2 0.577 0.423
   3 0.627 0.373</code></pre>
</div>
</div>
<ul>
<li><span class="math inline">\(\chi^2\)</span> test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(race, low)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  race and low
X-squared = 5.0048, df = 2, p-value = 0.08189</code></pre>
</div>
</div>
<ul>
<li>Univariate logistic model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>conf_mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(conf_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = low ~ race, family = "binomial")

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.0489  -0.9665  -0.7401   1.4042   1.6905  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -1.1550     0.2391  -4.830 1.36e-06 ***
race2         0.8448     0.4634   1.823   0.0683 .  
race3         0.6362     0.3478   1.829   0.0674 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 234.67  on 188  degrees of freedom
Residual deviance: 229.66  on 186  degrees of freedom
AIC: 235.66

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">confint</span>(conf_mod)),<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            2.5 % 97.5 %
(Intercept) 0.193  0.495
race2       0.926  5.775
race3       0.957  3.758</code></pre>
</div>
</div>
</section>
<section id="adjusting-for-race" class="level4">
<h4 class="anchored" data-anchor-id="adjusting-for-race">Adjusting for <code>race</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>or_crude <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">OddsRatio</span>(<span class="fu">table</span>(smoke, low), <span class="at">conf.level =</span> .<span class="dv">95</span>),<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The marginal (unadjusted) <span class="math inline">\(OR_{smoke} = 2.022\)</span> <span class="math inline">\(\left[1.081 - 3.783 \right]\)</span></p>
<ul>
<li>Marginal <span class="math inline">\(\chi^2\)</span> test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(smoke, low)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with Yates' continuity correction

data:  smoke and low
X-squared = 4.2359, df = 1, p-value = 0.03958</code></pre>
</div>
</div>
<section id="stratification" class="level5">
<h5 class="anchored" data-anchor-id="stratification">Stratification</h5>
<p><strong>1.</strong> Construct the 2x2xk table for <code>smoke</code> x <code>low</code> x <code>race</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ptt <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> smoke <span class="sc">+</span> low <span class="sc">+</span> race)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>2.</strong> Test for effect modification</p>
<p><strong>2.1</strong> Woolf test for Homogeneity of <span class="math inline">\(\ln OR\)</span> accross strata</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">WoolfTest</span>(ptt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Woolf Test on Homogeneity of Odds Ratios (no 3-Way assoc.)

data:  ptt
X-squared = 3.0166, df = 2, p-value = 0.2213</code></pre>
</div>
</div>
<p><strong>2.2</strong> Breslow-Day test for Homogeneity of <span class="math inline">\(OR\)</span> accross strata</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BreslowDayTest</span>(ptt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Breslow-Day test on Homogeneity of Odds Ratios

data:  ptt
X-squared = 3.1259, df = 2, p-value = 0.2095</code></pre>
</div>
</div>
<p><strong>3.</strong> Mantel-Haenszel estimate of the adjusted common <span class="math inline">\(OR\)</span></p>
<p>As the tests for effect modification are both <span class="math inline">\(n.s.\)</span>, the Mantel-Hanszel-test can be applied. It tests the hypothesis that <span class="math inline">\(OR_k = 1\)</span> accross all <span class="math inline">\(k\)</span> strata of the variable that is adjusted for.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>mh <span class="ot">&lt;-</span> <span class="fu">mantelhaen.test</span>(ptt)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>mh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mantel-Haenszel chi-squared test with continuity correction

data:  ptt
Mantel-Haenszel X-squared = 8.3779, df = 1, p-value = 0.003798
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
 1.490740 6.389949
sample estimates:
common odds ratio 
         3.086381 </code></pre>
</div>
</div>
<p>With <span class="math inline">\(p = 0.0038\)</span> from the MH-test, the data provides sufficient evidence to reject <span class="math inline">\(H_0\)</span> of <span class="math inline">\(OR_{adj} = 1\)</span>.<br>
The MH estimate of the true common <span class="math inline">\(OR = 3.086\)</span> is 1.526 times the crude estimation of the odds ratio, the <code>race</code> variable is likely a confounder of the association <code>smoke</code> <span class="math inline">\(\rightarrow\)</span> <code>low</code>.</p>
</section>
<section id="multivariate-logistic-regression-model" class="level5">
<h5 class="anchored" data-anchor-id="multivariate-logistic-regression-model">Multivariate logistic regression model</h5>
<ul>
<li>Build and examine unadjusted model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = low ~ smoke, family = "binomial")

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.0197  -0.7623  -0.7623   1.3438   1.6599  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -1.0871     0.2147  -5.062 4.14e-07 ***
smoke1        0.7041     0.3196   2.203   0.0276 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 234.67  on 188  degrees of freedom
Residual deviance: 229.80  on 187  degrees of freedom
AIC: 233.8

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Unadjusted estimate of <span class="math inline">\(OR_{smoke} = 2.0219436\)</span></p>
<ul>
<li>Adjusting for <code>race</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = low ~ smoke + race, family = "binomial")

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.3442  -0.8862  -0.5428   1.4964   1.9939  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -1.8405     0.3529  -5.216 1.83e-07 ***
smoke1        1.1160     0.3692   3.023  0.00251 ** 
race2         1.0841     0.4900   2.212  0.02693 *  
race3         1.1086     0.4003   2.769  0.00562 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 234.67  on 188  degrees of freedom
Residual deviance: 219.97  on 185  degrees of freedom
AIC: 227.97

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Adjusted estimate of <span class="math inline">\(OR_{smoke} = 3.0526312\)</span></p>
</section>
</section>
</section>
</section>
<section id="mediating-variables" class="level2">
<h2 class="anchored" data-anchor-id="mediating-variables">Mediating variables</h2>
<section id="concepts" class="level3">
<h3 class="anchored" data-anchor-id="concepts">Concepts</h3>
<ul>
<li>Criteria for a mediating variable <span class="math inline">\(F\)</span>
<ul>
<li>Do these association conceptually make sense ? :
<ol type="1">
<li>Is <span class="math inline">\(F\)</span> associated with <span class="math inline">\(E\)</span> ? IS <span class="math inline">\(F\)</span> on the pathway <span class="math inline">\(E \rightarrow Y\)</span>?</li>
<li>Is <span class="math inline">\(F\)</span> associated with <span class="math inline">\(Y\)</span> ?</li>
</ol></li>
<li>Does including <span class="math inline">\(F\)</span> significantly change <span class="math inline">\(b_1\)</span> while not inflating <span class="math inline">\(\sigma_b\)</span> ?</li>
</ul></li>
</ul>
<p>Numerically, mediating variables behave the same way as confounders which gives a crucial role to conceptual assessment when considering whether or not to include the variable in the final model. When building effect size models, usually mediating variables are not included as they would â€œscrape offâ€ a fraction of the effect size of the variable of interest</p>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p><span class="math inline">\(Q\)</span>: Does previous premature labour <code>ptl</code> mediate the effect of <code>smoke</code> on <code>low</code>?</p>
<div class="cell" data-fig-width="2" data-fig-height="2" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="192" height="192" viewbox="0.00 0.00 224.25 67.71" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 63.71)">
<title>P</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-63.71 220.25,-63.71 220.25,4 -4,4"></polygon>
<!-- smoke -->
<g id="node1" class="node">
<title>smoke</title>
<ellipse fill="none" stroke="black" cx="36.25" cy="-18" rx="36.5" ry="18"></ellipse>
<text text-anchor="middle" x="36.25" y="-13.8" font-family="Times,serif" font-size="14.00">smoke</text>
</g>
<!-- ptl -->
<g id="node2" class="node">
<title>ptl</title>
<ellipse fill="none" stroke="black" cx="117.25" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="117.25" y="-13.8" font-family="Times,serif" font-size="14.00">ptl</text>
</g>
<!-- smoke&#45;&gt;ptl -->
<g id="edge1" class="edge">
<title>smoke-&gt;ptl</title>
<path fill="none" stroke="black" d="M72.64,-18C75.09,-18 77.54,-18 79.99,-18"></path>
<polygon fill="black" stroke="black" points="80.06,-21.5 90.06,-18 80.06,-14.5 80.06,-21.5"></polygon>
</g>
<!-- low -->
<g id="node3" class="node">
<title>low</title>
<ellipse fill="none" stroke="black" cx="189.25" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="189.25" y="-13.8" font-family="Times,serif" font-size="14.00">low</text>
</g>
<!-- smoke&#45;&gt;low -->
<g id="edge3" class="edge">
<title>smoke-&gt;low</title>
<path fill="none" stroke="black" d="M54.33,-33.99C64.21,-41.65 77.09,-50.02 90.25,-54 113.22,-60.95 121.6,-61.94 144.25,-54 152.48,-51.11 160.32,-46.02 167.09,-40.55"></path>
<polygon fill="black" stroke="black" points="169.83,-42.8 175.03,-33.57 165.21,-37.54 169.83,-42.8"></polygon>
</g>
<!-- ptl&#45;&gt;low -->
<g id="edge2" class="edge">
<title>ptl-&gt;low</title>
<path fill="none" stroke="black" d="M144.25,-18C146.86,-18 149.48,-18 152.09,-18"></path>
<polygon fill="black" stroke="black" points="152.18,-21.5 162.18,-18 152.18,-14.5 152.18,-21.5"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p><strong>1.</strong> Checking the association of <code>smoke</code> and <code>ptl</code></p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Mosaic plot</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">table</span>(smoke, ptl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Test</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(smoke, ptl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with Yates' continuity correction

data:  smoke and ptl
X-squared = 5.5065, df = 1, p-value = 0.01895</code></pre>
</div>
</div>
<p><strong>2.</strong> Checking the association of <code>ptl</code> and <code>low</code></p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Mosaic plot</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">table</span>(ptl, low))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Test</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(ptl, low)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with Yates' continuity correction

data:  ptl and low
X-squared = 12.212, df = 1, p-value = 0.0004749</code></pre>
</div>
</div>
<p><strong>3.</strong> Comparing model w/o and with mediating variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> ptl, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model1); <span class="fu">coef</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)      smoke1 
 -1.0870515   0.7040592 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)      smoke1        ptl1 
 -1.2616943   0.5364762   1.3516607 </code></pre>
</div>
</div>
<p>As expected, the coefficient of <code>smoke</code> in presence of the <code>ptl</code> variable is decreased (same as for a confounding variable). Based on the causal considerations, <code>ptl</code> is identified as a mediating factor and would not be included in an effect size model for <code>smoke</code>.</p>
</section>
</section>
<section id="likelihood-ratio-test-lrt" class="level2">
<h2 class="anchored" data-anchor-id="likelihood-ratio-test-lrt">Likelihood-Ratio-Test (LRT)</h2>
<section id="nested-models" class="level3">
<h3 class="anchored" data-anchor-id="nested-models">Nested models</h3>
<section id="fit-reduced-and-full-model" class="level4">
<h4 class="anchored" data-anchor-id="fit-reduced-and-full-model">Fit reduced and full model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> race <span class="sc">+</span> smoke<span class="sc">*</span>race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="testing-model-significance" class="level4">
<h4 class="anchored" data-anchor-id="testing-model-significance">Testing model significance</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1, m2, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: low ~ smoke + race
Model 2: low ~ smoke + race + smoke * race
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1       185     219.97                     
2       183     216.82  2   3.1569   0.2063</code></pre>
</div>
</div>
</section>
</section>
<section id="overall-model-significance" class="level3">
<h3 class="anchored" data-anchor-id="overall-model-significance">Overall model significance</h3>
<p>Test a given model against a null-model (no coefficients, only intercept, thus just <span class="math inline">\(\hat p\)</span> of the outcome)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>nullmod <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(nullmod, <span class="at">type =</span> <span class="st">'response'</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5 
0.3121693 0.3121693 0.3121693 0.3121693 0.3121693 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(nullmod, m1, <span class="at">test=</span><span class="st">'LRT'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: low ~ 1
Model 2: low ~ smoke + race
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)   
1       188     234.67                        
2       185     219.97  3   14.697 0.002094 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="effect-modification-and-interaction" class="level2">
<h2 class="anchored" data-anchor-id="effect-modification-and-interaction">Effect modification and Interaction</h2>
<section id="concepts-1" class="level3">
<h3 class="anchored" data-anchor-id="concepts-1">Concepts</h3>
<div class="cell" data-fig-width="3" data-fig-height="3" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="288" height="288" viewbox="0.00 0.00 192.00 98.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 94)">
<title>P</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-94 188,-94 188,4 -4,4"></polygon>
<!-- X1 -->
<g id="node1" class="node">
<title>X1</title>
<ellipse fill="none" stroke="black" cx="27" cy="-72" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-67.8" font-family="Times,serif" font-size="14.00">X1</text>
</g>
<!-- Int -->
<g id="node3" class="node">
<title>Int</title>
<polygon fill="black" stroke="black" points="94,-47 90,-47 90,-43 94,-43 94,-47"></polygon>
<text text-anchor="middle" x="92" y="-44.7" font-family="Times,serif" font-size="1.00">Int</text>
</g>
<!-- X1&#45;&gt;Int -->
<g id="edge1" class="edge">
<title>X1-&gt;Int</title>
<path fill="none" stroke="black" d="M50.03,-62.56C60.47,-58.09 72.43,-52.96 80.72,-49.41"></path>
<polygon fill="black" stroke="black" points="82.17,-52.59 89.98,-45.44 79.41,-46.16 82.17,-52.59"></polygon>
</g>
<!-- F -->
<g id="node2" class="node">
<title>F</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Times,serif" font-size="14.00">F</text>
</g>
<!-- F&#45;&gt;Int -->
<g id="edge2" class="edge">
<title>F-&gt;Int</title>
<path fill="none" stroke="black" d="M50.03,-27.44C60.47,-31.91 72.43,-37.04 80.72,-40.59"></path>
<polygon fill="black" stroke="black" points="79.41,-43.84 89.98,-44.56 82.17,-37.41 79.41,-43.84"></polygon>
</g>
<!-- Y -->
<g id="node4" class="node">
<title>Y</title>
<ellipse fill="none" stroke="black" cx="157" cy="-45" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="157" y="-40.8" font-family="Times,serif" font-size="14.00">Y</text>
</g>
<!-- Int&#45;&gt;Y -->
<g id="edge3" class="edge">
<title>Int-&gt;Y</title>
<path fill="none" stroke="black" d="M93.28,-42.97C95.59,-34.88 111.73,-31.06 127.05,-31.54"></path>
<polygon fill="black" stroke="black" points="127.06,-35.06 137.35,-32.55 127.74,-28.09 127.06,-35.06"></polygon>
</g>
<!-- Int&#45;&gt;Y -->
<g id="edge4" class="edge">
<title>Int-&gt;Y</title>
<path fill="none" stroke="black" d="M94.09,-45C97.46,-45 108.11,-45 119.66,-45"></path>
<polygon fill="black" stroke="black" points="119.87,-48.5 129.87,-45 119.87,-41.5 119.87,-48.5"></polygon>
</g>
<!-- Int&#45;&gt;Y -->
<g id="edge5" class="edge">
<title>Int-&gt;Y</title>
<path fill="none" stroke="black" d="M93.28,-47.03C95.59,-55.12 111.73,-58.94 127.05,-58.46"></path>
<polygon fill="black" stroke="black" points="127.74,-61.91 137.35,-57.45 127.06,-54.94 127.74,-61.91"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ol type="1">
<li>Does the interaction conceptually make sense ?</li>
<li>Is <span class="math inline">\(X2\)</span> <strong>NOT</strong> on the pathway <span class="math inline">\(X1 \rightarrow Y\)</span>?</li>
<li>The interaction is statistically significant.</li>
</ol>
<p>Mathematically: <span class="math inline">\(OR_{F_i} \not = OR_{F_j}\)</span></p>
</section>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example</h3>
<p><span class="math inline">\(Q\)</span>: Does <code>race</code> modify the effect of <code>smoke</code> on <code>low</code>?</p>
<ol type="1">
<li>It is known for other exposures, that race is an effect modifier</li>
<li><code>smoke</code> does certainly not influence <code>race</code></li>
<li>TBD</li>
</ol>
<p>If <code>race</code> is an effect modifier, an <span class="math inline">\(OR\)</span> for the impact of <code>smoke</code> for each level of <code>race</code> has to be determined:</p>
<ul>
<li><span class="math inline">\(OR_{white}\)</span></li>
<li><span class="math inline">\(OR_{black}\)</span></li>
<li><span class="math inline">\(OR_{other}\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>intmod <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> race <span class="sc">+</span> smoke<span class="sc">*</span>race, <span class="at">family=</span><span class="st">'binomial'</span>,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> lbw)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(intmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = low ~ smoke + race + smoke * race, family = "binomial", 
    data = lbw)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.3537  -0.9508  -0.4366   1.4190   2.1899  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   -2.3026     0.5243  -4.392 1.12e-05 ***
smoke1         1.7505     0.5982   2.926  0.00343 ** 
race2          1.5141     0.7522   2.013  0.04412 *  
race3          1.7430     0.5945   2.932  0.00337 ** 
smoke1:race2  -0.5566     1.0322  -0.539  0.58972    
smoke1:race3  -1.5274     0.8828  -1.730  0.08359 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 234.67  on 188  degrees of freedom
Residual deviance: 216.82  on 183  degrees of freedom
AIC: 228.82

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>cs <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(intmod<span class="sc">$</span>coefficients), <span class="dv">3</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>cs_int <span class="ot">&lt;-</span> <span class="fu">confint</span>(intmod) <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">exp</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(cs, cs_int)            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                cs 2.5 % 97.5 %
(Intercept)  0.100 0.030  0.248
smoke1       5.758 1.939 21.366
race2        4.545 1.040 21.301
race3        5.714 1.942 21.089
smoke1:race2 0.573 0.074  4.467
smoke1:race3 0.217 0.035  1.171</code></pre>
</div>
</div>
<ul>
<li>Equation with fitted model parameters</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\log\left[ \frac { \widehat{P( \operatorname{low} = \operatorname{1} )} }{ 1 - \widehat{P( \operatorname{low} = \operatorname{1} )} } \right] &amp;= -2.3 + 1.75(\operatorname{smoke}_{\operatorname{1}}) + 1.51(\operatorname{race}_{\operatorname{2}}) + 1.74(\operatorname{race}_{\operatorname{3}})\ - \\
&amp;\quad 0.56(\operatorname{smoke}_{\operatorname{1}} \times \operatorname{race}_{\operatorname{2}}) - 1.53(\operatorname{smoke}_{\operatorname{1}} \times \operatorname{race}_{\operatorname{3}})
\end{aligned}
\]</span></p>
<p>The coefficient for an exposure <span class="math inline">\(E\)</span> for a given level of an effect modifier <span class="math inline">\(F\)</span> is given by</p>
<p><span class="math display">\[\beta_E + \beta_{E \times F=k}\]</span></p>
<p>Therefore</p>
<p><span class="math display">\[OR_{smoke} \text{ by race }= e^{\beta_{smoke}+\sum_i^k \beta_{smoke \times k}I_k}\]</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(F\)</span> <code>race</code></th>
<th><span class="math inline">\(OR_{F=k}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>white (rev)</td>
<td>5.75</td>
</tr>
<tr class="even">
<td>black (race2)</td>
<td>3.29</td>
</tr>
<tr class="odd">
<td>other (race3)</td>
<td>1.25</td>
</tr>
</tbody>
</table>
<p>The statistical significance can be determined also by a likelihood-ratio test.</p>
</section>
</section>
<section id="model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="model-assumptions">Model assumptions</h2>
<ol type="1">
<li>Linearity of <span class="math inline">\(X \sim \ln odds\)</span>, needs to be checked</li>
<li>Independent <span class="math inline">\(Y\)</span> values, determined by study design</li>
</ol>
<p>The following are assumed/true given the structure of the data (in contrary to linear regression where normality assumptions needs to be verified) 3. Errors are binomially distributed 4. Variance depends on <span class="math inline">\(p\)</span></p>
<section id="linearity-check" class="level3">
<h3 class="anchored" data-anchor-id="linearity-check">Linearity check</h3>
<ul>
<li>only necessary for numeric variables</li>
<li>quantise into 3-5 (based on quantiles) groups</li>
<li>estimate <span class="math inline">\(\hat p = \{\hat p_1, \ldots , \hat p_k \}\)</span></li>
<li>calculate <span class="math inline">\(\forall k: \operatorname{Logit}(\hat p_k)\)</span></li>
<li>plot results against median (robust wrt outliers) of groups <span class="math inline">\(\Rightarrow\)</span> Line ?</li>
</ul>
<section id="example-using-lwt" class="level4">
<h4 class="anchored" data-anchor-id="example-using-lwt">Example using <code>lwt</code></h4>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Outcome probabilities by Quantiles</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>lbw<span class="sc">$</span>lwtcat <span class="ot">&lt;-</span> <span class="fu">cut</span>(lwt, <span class="at">breaks =</span> <span class="fu">quantile</span>(lwt, <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)),</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">include.lowest=</span>T, <span class="at">right=</span>F)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">table</span>(lbw<span class="sc">$</span>lwtcat,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>             low) <span class="sc">%&gt;%</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">prop.table</span>(<span class="at">margin =</span> <span class="dv">1</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>ps        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>           low
                    0         1
  [80,110)  0.5000000 0.5000000
  [110,121) 0.7400000 0.2600000
  [121,140) 0.7234043 0.2765957
  [140,250] 0.7600000 0.2400000</code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>log odds</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>logodds <span class="ot">&lt;-</span> <span class="fu">log</span>(ps[,<span class="dv">2</span>]<span class="sc">/</span>ps[,<span class="dv">1</span>])</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>logodds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  [80,110)  [110,121)  [121,140)  [140,250] 
 0.0000000 -1.0459686 -0.9614112 -1.1526795 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Plot against group medians</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> lbw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(lwtcat) <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">summarise</span>(<span class="at">med =</span> <span class="fu">median</span>(lwt))</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(medians<span class="sc">$</span>med, logodds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CHD_logistic_regression_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the plot it seems that there is no linear relationship between <code>lwt</code> and <code>low</code>. Based on the information obtained, a new dichotomous variable will be created <code>lwd</code>, with</p>
<p><span class="math display">\[lwd =
\begin{cases}
1 \quad \mid lwt&lt;110\\
0 \quad \mid lwt \geq 110
\end{cases}\]</span></p>


<!-- -->

</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb93" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Practical -  Logistic regression in R</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: true</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true </span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co">    css: chd.css</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"equatiomatic"</span>)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># Load the data and inspect</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load data</span></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>chd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/amayomode/Heart-Disease-Risk-Prediction/master/Heart%20Disease%20Prediction/data/framingham.csv'</span>))</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a><span class="co">#binning age variable</span></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>chd<span class="sc">$</span>AgeCat <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cut</span>(chd<span class="sc">$</span>age, <span class="at">breaks=</span><span class="dv">8</span>))</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(chd)</span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(chd)</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot age vs. target</span></span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(chd, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> TenYearCHD)) <span class="sc">+</span></span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>pp</span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>mean_age_healthy <span class="ot">&lt;-</span> <span class="fu">mean</span>(age[TenYearCHD<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a>mean_age_chd <span class="ot">&lt;-</span> <span class="fu">mean</span>(age[TenYearCHD<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a>Mean age healthy subjects: <span class="in">`r round(mean_age_healthy, 2)`</span></span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a>Mean age diseased subjects: <span class="in">`r round(mean_age_chd, 2)`</span></span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-64"><a href="#cb93-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-65"><a href="#cb93-65" aria-hidden="true" tabindex="-1"></a>interval_midpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(s){</span>
<span id="cb93-66"><a href="#cb93-66" aria-hidden="true" tabindex="-1"></a>  midpoint <span class="ot">&lt;-</span> <span class="fu">substring</span>(s, <span class="dv">2</span>, <span class="fu">str_length</span>(s)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-67"><a href="#cb93-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">","</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-68"><a href="#cb93-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-69"><a href="#cb93-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(as.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb93-70"><a href="#cb93-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>()</span>
<span id="cb93-71"><a href="#cb93-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (midpoint)</span>
<span id="cb93-72"><a href="#cb93-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-73"><a href="#cb93-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-74"><a href="#cb93-74" aria-hidden="true" tabindex="-1"></a>interval_ul <span class="ot">&lt;-</span> <span class="cf">function</span>(s){</span>
<span id="cb93-75"><a href="#cb93-75" aria-hidden="true" tabindex="-1"></a>  ul <span class="ot">&lt;-</span> <span class="fu">substring</span>(s, <span class="dv">2</span>, <span class="fu">str_length</span>(s)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-76"><a href="#cb93-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">","</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-77"><a href="#cb93-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-78"><a href="#cb93-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(as.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb93-79"><a href="#cb93-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.vector</span>()</span>
<span id="cb93-80"><a href="#cb93-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (ul[<span class="dv">2</span>])</span>
<span id="cb93-81"><a href="#cb93-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-82"><a href="#cb93-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-83"><a href="#cb93-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-86"><a href="#cb93-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-87"><a href="#cb93-87" aria-hidden="true" tabindex="-1"></a>p_per_age <span class="ot">&lt;-</span> chd <span class="sc">%&gt;%</span> </span>
<span id="cb93-88"><a href="#cb93-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(AgeCat) <span class="sc">%&gt;%</span> </span>
<span id="cb93-89"><a href="#cb93-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">mean</span>(TenYearCHD))</span>
<span id="cb93-90"><a href="#cb93-90" aria-hidden="true" tabindex="-1"></a>p_per_age<span class="sc">$</span>midpoint <span class="ot">&lt;-</span> <span class="fu">sapply</span>(p_per_age<span class="sc">$</span>AgeCat, interval_midpoint)  </span>
<span id="cb93-91"><a href="#cb93-91" aria-hidden="true" tabindex="-1"></a>p_per_age<span class="sc">$</span>ul <span class="ot">&lt;-</span> <span class="fu">sapply</span>(p_per_age<span class="sc">$</span>AgeCat, interval_ul)  </span>
<span id="cb93-92"><a href="#cb93-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-93"><a href="#cb93-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-96"><a href="#cb93-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-97"><a href="#cb93-97" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Probability of CHD per age category (red dots), upper limit of age category (veritcal lines)</span></span>
<span id="cb93-98"><a href="#cb93-98" aria-hidden="true" tabindex="-1"></a>pp <span class="sc">+</span></span>
<span id="cb93-99"><a href="#cb93-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span>p), <span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb93-100"><a href="#cb93-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> p_per_age, <span class="fu">aes</span>(<span class="at">xintercept=</span>ul))</span>
<span id="cb93-101"><a href="#cb93-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-102"><a href="#cb93-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-105"><a href="#cb93-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-106"><a href="#cb93-106" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: body</span></span>
<span id="cb93-107"><a href="#cb93-107" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb93-108"><a href="#cb93-108" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span>p)) <span class="sc">+</span></span>
<span id="cb93-109"><a href="#cb93-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb93-110"><a href="#cb93-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb93-111"><a href="#cb93-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-112"><a href="#cb93-112" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span><span class="fu">log</span>(p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)))) <span class="sc">+</span></span>
<span id="cb93-113"><a href="#cb93-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb93-114"><a href="#cb93-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb93-115"><a href="#cb93-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-116"><a href="#cb93-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-117"><a href="#cb93-117" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model with `age` as continous variable</span></span>
<span id="cb93-118"><a href="#cb93-118" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fit and model summary</span></span>
<span id="cb93-121"><a href="#cb93-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-122"><a href="#cb93-122" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(TenYearCHD <span class="sc">~</span> age, <span class="at">data=</span>chd, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-123"><a href="#cb93-123" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb93-124"><a href="#cb93-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-125"><a href="#cb93-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-126"><a href="#cb93-126" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predicted outcome by age</span></span>
<span id="cb93-129"><a href="#cb93-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-130"><a href="#cb93-130" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict.glm</span>(model, <span class="at">type=</span><span class="fu">c</span>(<span class="st">'response'</span>))</span>
<span id="cb93-131"><a href="#cb93-131" aria-hidden="true" tabindex="-1"></a>sm_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">spline</span>(chd<span class="sc">$</span>age, pred))</span>
<span id="cb93-132"><a href="#cb93-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-133"><a href="#cb93-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-134"><a href="#cb93-134" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualisation</span></span>
<span id="cb93-135"><a href="#cb93-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-138"><a href="#cb93-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-139"><a href="#cb93-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: body</span></span>
<span id="cb93-140"><a href="#cb93-140" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb93-141"><a href="#cb93-141" aria-hidden="true" tabindex="-1"></a>pp <span class="sc">+</span></span>
<span id="cb93-142"><a href="#cb93-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span>p), <span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb93-143"><a href="#cb93-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> sm_pred, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb93-144"><a href="#cb93-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Model fitted values of P(Y=1|X)'</span>)</span>
<span id="cb93-145"><a href="#cb93-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-146"><a href="#cb93-146" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_per_age, <span class="fu">aes</span>(<span class="at">x=</span>midpoint, <span class="at">y=</span><span class="fu">log</span>(p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)))) <span class="sc">+</span></span>
<span id="cb93-147"><a href="#cb93-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb93-148"><a href="#cb93-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">fortify</span>(model), <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb93-149"><a href="#cb93-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Model fitted values of the link function'</span>)</span>
<span id="cb93-150"><a href="#cb93-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-151"><a href="#cb93-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-152"><a href="#cb93-152" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model equation, linear generalization</span></span>
<span id="cb93-153"><a href="#cb93-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-154"><a href="#cb93-154" aria-hidden="true" tabindex="-1"></a>$Y$: binary outcome, coded as $0/1$ (*e.g.* diseased, non-diseased)</span>
<span id="cb93-155"><a href="#cb93-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-156"><a href="#cb93-156" aria-hidden="true" tabindex="-1"></a>$X$: explanatory variable</span>
<span id="cb93-157"><a href="#cb93-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-158"><a href="#cb93-158" aria-hidden="true" tabindex="-1"></a>$\hat p = P(Y=1 | X)$ cannot be modeled with a linear function of the form $\hat p = b_0+b_1X$, as it is not appropiately bounded in $\left<span class="co">[</span><span class="ot">0,1\right</span><span class="co">]</span>$. </span>
<span id="cb93-159"><a href="#cb93-159" aria-hidden="true" tabindex="-1"></a>One suitable function to model $\hat p$ is :</span>
<span id="cb93-160"><a href="#cb93-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-161"><a href="#cb93-161" aria-hidden="true" tabindex="-1"></a>$$\hat p = \frac{e^{b_0+b_1X}}{1+e^{b_0+b_1X}}$$</span>
<span id="cb93-162"><a href="#cb93-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-163"><a href="#cb93-163" aria-hidden="true" tabindex="-1"></a>From this equation follows, that :</span>
<span id="cb93-164"><a href="#cb93-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-165"><a href="#cb93-165" aria-hidden="true" tabindex="-1"></a>$$\operatorname{Logit}\left(\hat p\right) =\ln \left(\frac{\hat p}{1-\hat p}\right) = b_0+b_1X$$</span>
<span id="cb93-166"><a href="#cb93-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-167"><a href="#cb93-167" aria-hidden="true" tabindex="-1"></a>The $log-odds$ of $\hat p = P(Y=1|X)$ is a linear function of $X$. From the odds of $Y=1$, $P(Y=1|X)$ can be calculated - $\operatorname{Logit}$ is called link function in Logistic regression.</span>
<span id="cb93-168"><a href="#cb93-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-169"><a href="#cb93-169" aria-hidden="true" tabindex="-1"></a><span class="fu"># Interpretation of the model output</span></span>
<span id="cb93-170"><a href="#cb93-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-173"><a href="#cb93-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-174"><a href="#cb93-174" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb93-175"><a href="#cb93-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-176"><a href="#cb93-176" aria-hidden="true" tabindex="-1"></a>intcp <span class="ot">&lt;-</span> <span class="fu">round</span>(model<span class="sc">$</span>coefficients[<span class="st">'(Intercept)'</span>],<span class="dv">3</span>)</span>
<span id="cb93-177"><a href="#cb93-177" aria-hidden="true" tabindex="-1"></a>b_age <span class="ot">&lt;-</span> <span class="fu">round</span>(model<span class="sc">$</span>coefficients[<span class="st">'age'</span>], <span class="dv">3</span>)</span>
<span id="cb93-178"><a href="#cb93-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-179"><a href="#cb93-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-180"><a href="#cb93-180" aria-hidden="true" tabindex="-1"></a>The model provides the following estimation:</span>
<span id="cb93-181"><a href="#cb93-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-182"><a href="#cb93-182" aria-hidden="true" tabindex="-1"></a>$$\hat p = \frac{e^{<span class="in">`r intcp`</span> + <span class="in">`r b_age`</span> \times age}}{1+e^{<span class="in">`r intcp`</span> + <span class="in">`r b_age`</span> \times age}}$$</span>
<span id="cb93-183"><a href="#cb93-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-184"><a href="#cb93-184" aria-hidden="true" tabindex="-1"></a>Example for a subject with $age=32$:</span>
<span id="cb93-185"><a href="#cb93-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-186"><a href="#cb93-186" aria-hidden="true" tabindex="-1"></a>$$P(Y=1 | X=32) = \frac{e^{<span class="in">`r intcp`</span> + <span class="in">`r b_age`</span> \times 32}}{1+e^{<span class="in">`r intcp`</span> + <span class="in">`r b_age`</span> \times 32}} = <span class="in">`r predict(model, data.frame(age=32, diabetes=0, currentSmoker=0, prevalentHyp = 0), type=c('response')) %&gt;% round(3)`</span>$$</span>
<span id="cb93-187"><a href="#cb93-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-188"><a href="#cb93-188" aria-hidden="true" tabindex="-1"></a><span class="fu"># Interpretation of model coefficients</span></span>
<span id="cb93-189"><a href="#cb93-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-190"><a href="#cb93-190" aria-hidden="true" tabindex="-1"></a><span class="fu">## General case</span></span>
<span id="cb93-191"><a href="#cb93-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-192"><a href="#cb93-192" aria-hidden="true" tabindex="-1"></a>$$\ln \left(\frac{\hat p}{1-\hat p}\right) = b_0+b_1X$$ </span>
<span id="cb93-193"><a href="#cb93-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-194"><a href="#cb93-194" aria-hidden="true" tabindex="-1"></a>:::{.column-margin}</span>
<span id="cb93-195"><a href="#cb93-195" aria-hidden="true" tabindex="-1"></a>$\ln \left(\frac{\hat p}{1-\hat p}\right)$: $\text{log-odds of }Y=1$</span>
<span id="cb93-196"><a href="#cb93-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-197"><a href="#cb93-197" aria-hidden="true" tabindex="-1"></a>$b_0$: log-odds of $Y=1$ $\forall X: X=0 / ref$</span>
<span id="cb93-198"><a href="#cb93-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-199"><a href="#cb93-199" aria-hidden="true" tabindex="-1"></a>$b_1$: $\Delta$ in log-odds wrt to $\Delta X$</span>
<span id="cb93-200"><a href="#cb93-200" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-201"><a href="#cb93-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-202"><a href="#cb93-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Depending on the type of $X$, $e^b$ gives odds ratios</span></span>
<span id="cb93-203"><a href="#cb93-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-204"><a href="#cb93-204" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quantitative $X$</span></span>
<span id="cb93-205"><a href="#cb93-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-206"><a href="#cb93-206" aria-hidden="true" tabindex="-1"></a>::: {.columns}</span>
<span id="cb93-207"><a href="#cb93-207" aria-hidden="true" tabindex="-1"></a>::: {.column}</span>
<span id="cb93-208"><a href="#cb93-208" aria-hidden="true" tabindex="-1"></a>$b_1$: $\Delta$ in log-odds for a one unit increase in $X$</span>
<span id="cb93-209"><a href="#cb93-209" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-210"><a href="#cb93-210" aria-hidden="true" tabindex="-1"></a>::: {.column}</span>
<span id="cb93-211"><a href="#cb93-211" aria-hidden="true" tabindex="-1"></a>$e^b$ gives incremental inrease in $OR$ with a one unit increase of $X$</span>
<span id="cb93-212"><a href="#cb93-212" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-213"><a href="#cb93-213" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb93-214"><a href="#cb93-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-215"><a href="#cb93-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-216"><a href="#cb93-216" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary $X$</span></span>
<span id="cb93-217"><a href="#cb93-217" aria-hidden="true" tabindex="-1"></a>::: {.columns}</span>
<span id="cb93-218"><a href="#cb93-218" aria-hidden="true" tabindex="-1"></a>::: {.column}</span>
<span id="cb93-219"><a href="#cb93-219" aria-hidden="true" tabindex="-1"></a>$b_1$: $\Delta$ in log-odds for $X=1$ relative to $X=0$</span>
<span id="cb93-220"><a href="#cb93-220" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-221"><a href="#cb93-221" aria-hidden="true" tabindex="-1"></a>::: {.column}</span>
<span id="cb93-222"><a href="#cb93-222" aria-hidden="true" tabindex="-1"></a>$e^{b_1} = OR_{Y=1, \frac{X=1}{X=0}}$</span>
<span id="cb93-223"><a href="#cb93-223" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-224"><a href="#cb93-224" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb93-225"><a href="#cb93-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-226"><a href="#cb93-226" aria-hidden="true" tabindex="-1"></a><span class="fu">### Categorical X</span></span>
<span id="cb93-227"><a href="#cb93-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-228"><a href="#cb93-228" aria-hidden="true" tabindex="-1"></a>$X \in <span class="sc">\{</span>A, B, C<span class="sc">\}</span>$, $b_A$ is absorbed into reference</span>
<span id="cb93-229"><a href="#cb93-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-230"><a href="#cb93-230" aria-hidden="true" tabindex="-1"></a>::: {.columns}</span>
<span id="cb93-231"><a href="#cb93-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-232"><a href="#cb93-232" aria-hidden="true" tabindex="-1"></a>::: {.column}</span>
<span id="cb93-233"><a href="#cb93-233" aria-hidden="true" tabindex="-1"></a>$b_B$: $\Delta$ in log-odds for $X = B$</span>
<span id="cb93-234"><a href="#cb93-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-235"><a href="#cb93-235" aria-hidden="true" tabindex="-1"></a>$\vdots$</span>
<span id="cb93-236"><a href="#cb93-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-237"><a href="#cb93-237" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-238"><a href="#cb93-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-239"><a href="#cb93-239" aria-hidden="true" tabindex="-1"></a>::: {.column}</span>
<span id="cb93-240"><a href="#cb93-240" aria-hidden="true" tabindex="-1"></a>$e^{b_B} = OR_{Y=1, \frac{X=B}{X=A}}$</span>
<span id="cb93-241"><a href="#cb93-241" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-242"><a href="#cb93-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-243"><a href="#cb93-243" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-244"><a href="#cb93-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-245"><a href="#cb93-245" aria-hidden="true" tabindex="-1"></a><span class="fu">## Derivation of $e^\beta = OR$</span></span>
<span id="cb93-246"><a href="#cb93-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-247"><a href="#cb93-247" aria-hidden="true" tabindex="-1"></a>Consider a one-unit increase in $X$</span>
<span id="cb93-248"><a href="#cb93-248" aria-hidden="true" tabindex="-1"></a>$$\ln \left(\frac{\hat p}{1-\hat p}\right) = b_0+b_1X$$</span>
<span id="cb93-249"><a href="#cb93-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-250"><a href="#cb93-250" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-251"><a href="#cb93-251" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb93-252"><a href="#cb93-252" aria-hidden="true" tabindex="-1"></a>\ln OR &amp;= \ln \left(\frac{\operatorname{Logit}(Y=1, X=a+1)}{\operatorname{Logit}(Y=1, X=a)}\right) <span class="sc">\\</span></span>
<span id="cb93-253"><a href="#cb93-253" aria-hidden="true" tabindex="-1"></a>\ln OR &amp;= \ln \left<span class="co">[</span><span class="ot">\operatorname{Logit}(Y=1, X=a+1)\right</span><span class="co">]</span> - \ln \left<span class="co">[</span><span class="ot">\operatorname{Logit}(Y=1, X=a)\right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb93-254"><a href="#cb93-254" aria-hidden="true" tabindex="-1"></a>       &amp;= \left<span class="co">[</span><span class="ot">b_0+b_1\times (a+1)\right</span><span class="co">]</span> - \left<span class="co">[</span><span class="ot">b_0+b_1\times a \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb93-255"><a href="#cb93-255" aria-hidden="true" tabindex="-1"></a>\ln OR &amp;= b_1 <span class="sc">\\</span></span>
<span id="cb93-256"><a href="#cb93-256" aria-hidden="true" tabindex="-1"></a>    OR &amp;= e^{b_1}</span>
<span id="cb93-257"><a href="#cb93-257" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb93-258"><a href="#cb93-258" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-259"><a href="#cb93-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-260"><a href="#cb93-260" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multiple logistic regression</span></span>
<span id="cb93-261"><a href="#cb93-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-262"><a href="#cb93-262" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model structure</span></span>
<span id="cb93-263"><a href="#cb93-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-264"><a href="#cb93-264" aria-hidden="true" tabindex="-1"></a>$Y$: binary outcome, coded as $0/1$ (*e.g.* diseased, non-diseased)</span>
<span id="cb93-265"><a href="#cb93-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-266"><a href="#cb93-266" aria-hidden="true" tabindex="-1"></a>$X$: explanatory variables, vector</span>
<span id="cb93-267"><a href="#cb93-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-268"><a href="#cb93-268" aria-hidden="true" tabindex="-1"></a>$\beta$: coefficient vector</span>
<span id="cb93-269"><a href="#cb93-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-270"><a href="#cb93-270" aria-hidden="true" tabindex="-1"></a>$\beta_0$: intercept</span>
<span id="cb93-271"><a href="#cb93-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-272"><a href="#cb93-272" aria-hidden="true" tabindex="-1"></a>As for simple logistic regression, $\hat p = P(Y=1 | X_1, X_2, \ldots, X_i)$ cannot be modeled with a linear function of the form $\hat p = \beta_0+X \beta$, as it is not appropiately bounded in $\left<span class="co">[</span><span class="ot">0,1\right</span><span class="co">]</span>$. </span>
<span id="cb93-273"><a href="#cb93-273" aria-hidden="true" tabindex="-1"></a>One suitable function to model $\hat p$ is :</span>
<span id="cb93-274"><a href="#cb93-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-275"><a href="#cb93-275" aria-hidden="true" tabindex="-1"></a>$$\hat p = \frac{e^{\beta+X\beta}}{1+e^{\beta_0+X\beta}}$$</span>
<span id="cb93-276"><a href="#cb93-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-277"><a href="#cb93-277" aria-hidden="true" tabindex="-1"></a>From this equation follows, that :</span>
<span id="cb93-278"><a href="#cb93-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-279"><a href="#cb93-279" aria-hidden="true" tabindex="-1"></a>$$\operatorname{Logit}\left(\hat p\right) =\ln \left(\frac{\hat p}{1-\hat p}\right) = \beta_0+X \beta$$</span>
<span id="cb93-280"><a href="#cb93-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-281"><a href="#cb93-281" aria-hidden="true" tabindex="-1"></a><span class="fu">## Case study - Low birthweight dataset</span></span>
<span id="cb93-282"><a href="#cb93-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-283"><a href="#cb93-283" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data prep</span></span>
<span id="cb93-286"><a href="#cb93-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-287"><a href="#cb93-287" aria-hidden="true" tabindex="-1"></a>lbw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/SarthakDubey/CUDA-Logistic-Regression/master/lowbwt.csv'</span>) <span class="sc">%&gt;%</span> <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(ID))</span>
<span id="cb93-288"><a href="#cb93-288" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lbw) <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">names</span>(lbw), str_to_lower)</span>
<span id="cb93-289"><a href="#cb93-289" aria-hidden="true" tabindex="-1"></a><span class="co"># deriving lwd variable</span></span>
<span id="cb93-290"><a href="#cb93-290" aria-hidden="true" tabindex="-1"></a>lbw<span class="sc">$</span>lwd <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(lbw<span class="sc">$</span>lwt <span class="sc">&lt;</span> <span class="dv">110</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb93-291"><a href="#cb93-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-292"><a href="#cb93-292" aria-hidden="true" tabindex="-1"></a><span class="co"># releveling ptl</span></span>
<span id="cb93-293"><a href="#cb93-293" aria-hidden="true" tabindex="-1"></a>lbw<span class="sc">$</span>ptl <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(lbw<span class="sc">$</span>ptl <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb93-294"><a href="#cb93-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-295"><a href="#cb93-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-298"><a href="#cb93-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-299"><a href="#cb93-299" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (varname <span class="cf">in</span> <span class="fu">c</span>(<span class="st">'lwd'</span>, <span class="st">'race'</span>, <span class="st">'smoke'</span>, <span class="st">'ht'</span>, <span class="st">'ui'</span>, <span class="st">'ptl'</span>)){</span>
<span id="cb93-300"><a href="#cb93-300" aria-hidden="true" tabindex="-1"></a>  lbw[,varname] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">unlist</span>(lbw[,varname]))</span>
<span id="cb93-301"><a href="#cb93-301" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-302"><a href="#cb93-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-303"><a href="#cb93-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-306"><a href="#cb93-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-307"><a href="#cb93-307" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lbw)</span>
<span id="cb93-308"><a href="#cb93-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-309"><a href="#cb93-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-312"><a href="#cb93-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-313"><a href="#cb93-313" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbw)</span>
<span id="cb93-314"><a href="#cb93-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-315"><a href="#cb93-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-318"><a href="#cb93-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-319"><a href="#cb93-319" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(lbw)</span>
<span id="cb93-320"><a href="#cb93-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-321"><a href="#cb93-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-322"><a href="#cb93-322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data exploration and toy model</span></span>
<span id="cb93-325"><a href="#cb93-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-326"><a href="#cb93-326" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(low)</span>
<span id="cb93-327"><a href="#cb93-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-328"><a href="#cb93-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-331"><a href="#cb93-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-332"><a href="#cb93-332" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(low))</span>
<span id="cb93-333"><a href="#cb93-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-334"><a href="#cb93-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-337"><a href="#cb93-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-338"><a href="#cb93-338" aria-hidden="true" tabindex="-1"></a>sake.of.discussion <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> lwt,</span>
<span id="cb93-339"><a href="#cb93-339" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-340"><a href="#cb93-340" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sake.of.discussion)</span>
<span id="cb93-341"><a href="#cb93-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-342"><a href="#cb93-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-345"><a href="#cb93-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-346"><a href="#cb93-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb93-347"><a href="#cb93-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-348"><a href="#cb93-348" aria-hidden="true" tabindex="-1"></a>intcp <span class="ot">&lt;-</span> <span class="fu">round</span>(sake.of.discussion<span class="sc">$</span>coefficients[<span class="st">'(Intercept)'</span>], <span class="dv">3</span>)</span>
<span id="cb93-349"><a href="#cb93-349" aria-hidden="true" tabindex="-1"></a>b_smoke <span class="ot">&lt;-</span> <span class="fu">round</span>(sake.of.discussion<span class="sc">$</span>coefficients[<span class="st">'smoke1'</span>],<span class="dv">3</span>)</span>
<span id="cb93-350"><a href="#cb93-350" aria-hidden="true" tabindex="-1"></a>b_age <span class="ot">&lt;-</span> <span class="fu">round</span>(sake.of.discussion<span class="sc">$</span>coefficients[<span class="st">'age'</span>],<span class="dv">3</span>)</span>
<span id="cb93-351"><a href="#cb93-351" aria-hidden="true" tabindex="-1"></a>b_race2 <span class="ot">&lt;-</span> <span class="fu">round</span>(sake.of.discussion<span class="sc">$</span>coefficients[<span class="st">'race2'</span>],<span class="dv">3</span>)</span>
<span id="cb93-352"><a href="#cb93-352" aria-hidden="true" tabindex="-1"></a>b_race3 <span class="ot">&lt;-</span> <span class="fu">round</span>(sake.of.discussion<span class="sc">$</span>coefficients[<span class="st">'race3'</span>],<span class="dv">3</span>)</span>
<span id="cb93-353"><a href="#cb93-353" aria-hidden="true" tabindex="-1"></a>b_lwt <span class="ot">&lt;-</span> <span class="fu">round</span>(sake.of.discussion<span class="sc">$</span>coefficients[<span class="st">'lwt'</span>], <span class="dv">3</span>)</span>
<span id="cb93-354"><a href="#cb93-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-355"><a href="#cb93-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-356"><a href="#cb93-356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Toy model equation</span></span>
<span id="cb93-357"><a href="#cb93-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-358"><a href="#cb93-358" aria-hidden="true" tabindex="-1"></a>$$\ln \left(\frac{\hat p}{1-\hat p}\right) = <span class="in">`r intcp`</span> + <span class="in">`r b_smoke`</span>\times smoke - <span class="in">`r abs(b_age)`</span> \times age + <span class="in">`r b_race2`</span> \times black + <span class="in">`r b_race3`</span> \times other - <span class="in">`r abs(b_lwt)`</span> \times lwt$$</span>
<span id="cb93-359"><a href="#cb93-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-360"><a href="#cb93-360" aria-hidden="true" tabindex="-1"></a>Prediction for a 35-year old, white, smoker with $lwt=135$:</span>
<span id="cb93-361"><a href="#cb93-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-364"><a href="#cb93-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-365"><a href="#cb93-365" aria-hidden="true" tabindex="-1"></a>to_pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age=</span><span class="dv">35</span>, <span class="at">smoke =</span> <span class="fu">as.factor</span>(<span class="dv">1</span>), <span class="at">race=</span><span class="fu">as.factor</span>(<span class="dv">1</span>), <span class="at">lwt=</span><span class="dv">135</span>)</span>
<span id="cb93-366"><a href="#cb93-366" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">predict</span>(sake.of.discussion, to_pred, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">'response'</span>))</span>
<span id="cb93-367"><a href="#cb93-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-368"><a href="#cb93-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-369"><a href="#cb93-369" aria-hidden="true" tabindex="-1"></a>$$\hat p = <span class="in">`r round(phat, 3)`</span>$$</span>
<span id="cb93-370"><a href="#cb93-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-371"><a href="#cb93-371" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculation and Intepretation of $OR_{smoke}$</span></span>
<span id="cb93-372"><a href="#cb93-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-373"><a href="#cb93-373" aria-hidden="true" tabindex="-1"></a>$$OR_{smoke} = e^{<span class="in">`r b_smoke`</span>} = <span class="in">`r round(exp(b_smoke),2)`</span>$$</span>
<span id="cb93-374"><a href="#cb93-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-375"><a href="#cb93-375" aria-hidden="true" tabindex="-1"></a>The odds of low birthweight for a mother who smoked during pregnancy are <span class="in">`r round(exp(b_smoke), 2)`</span> the odds of low birthweight for a mother who did not smoke during pregnancy.</span>
<span id="cb93-376"><a href="#cb93-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-377"><a href="#cb93-377" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculation of $OR_{race3/race2}$ by hand</span></span>
<span id="cb93-378"><a href="#cb93-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-379"><a href="#cb93-379" aria-hidden="true" tabindex="-1"></a>$$OR_{race3/race2} = \frac{OR_{race3/ref}}{OR_{race2/ref}}$$ </span>
<span id="cb93-380"><a href="#cb93-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-381"><a href="#cb93-381" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculation of $OR_{race3/race2}$ in R</span></span>
<span id="cb93-382"><a href="#cb93-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-385"><a href="#cb93-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-386"><a href="#cb93-386" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(race)</span>
<span id="cb93-387"><a href="#cb93-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-388"><a href="#cb93-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-391"><a href="#cb93-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-392"><a href="#cb93-392" aria-hidden="true" tabindex="-1"></a>race.new <span class="ot">&lt;-</span> <span class="fu">relevel</span>(race, <span class="at">ref =</span> <span class="dv">3</span>)</span>
<span id="cb93-393"><a href="#cb93-393" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(race.new)</span>
<span id="cb93-394"><a href="#cb93-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-395"><a href="#cb93-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-396"><a href="#cb93-396" aria-hidden="true" tabindex="-1"></a>Reparameterized model</span>
<span id="cb93-397"><a href="#cb93-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-400"><a href="#cb93-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-401"><a href="#cb93-401" aria-hidden="true" tabindex="-1"></a>model.re <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> age <span class="sc">+</span> race.new <span class="sc">+</span> lwt,</span>
<span id="cb93-402"><a href="#cb93-402" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-403"><a href="#cb93-403" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(model.re))                          </span>
<span id="cb93-404"><a href="#cb93-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-405"><a href="#cb93-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-406"><a href="#cb93-406" aria-hidden="true" tabindex="-1"></a><span class="fu">### $ORs$ with their confidence intervals</span></span>
<span id="cb93-407"><a href="#cb93-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-410"><a href="#cb93-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-411"><a href="#cb93-411" aria-hidden="true" tabindex="-1"></a>ors <span class="ot">&lt;-</span> <span class="fu">exp</span>(sake.of.discussion<span class="sc">$</span>coefficients)</span>
<span id="cb93-412"><a href="#cb93-412" aria-hidden="true" tabindex="-1"></a>cits <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(sake.of.discussion))</span>
<span id="cb93-413"><a href="#cb93-413" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(ors, cits) <span class="sc">%&gt;%</span> </span>
<span id="cb93-414"><a href="#cb93-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-415"><a href="#cb93-415" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb93-416"><a href="#cb93-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-417"><a href="#cb93-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-418"><a href="#cb93-418" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking for Confounding</span></span>
<span id="cb93-419"><a href="#cb93-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-420"><a href="#cb93-420" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conceputally</span></span>
<span id="cb93-421"><a href="#cb93-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-422"><a href="#cb93-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Criteria for a confounding variable $F$</span>
<span id="cb93-423"><a href="#cb93-423" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Do the following associations conceptually make sense ?</span>
<span id="cb93-424"><a href="#cb93-424" aria-hidden="true" tabindex="-1"></a><span class="ss">    1. </span>Is $F$ associated with $E$ ? Is $F$ NOT on the pathway $E \rightarrow Y$?</span>
<span id="cb93-425"><a href="#cb93-425" aria-hidden="true" tabindex="-1"></a><span class="ss">    2. </span>Is $F$ associated with $Y$ ?</span>
<span id="cb93-426"><a href="#cb93-426" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Does including $F$ significantly change $b_1$ while not inflating $\sigma_b$ ?</span>
<span id="cb93-427"><a href="#cb93-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-428"><a href="#cb93-428" aria-hidden="true" tabindex="-1"></a>$Q$: Does <span class="in">`race`</span> confound the effect of <span class="in">`smoke`</span> on low birthweight?</span>
<span id="cb93-429"><a href="#cb93-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-432"><a href="#cb93-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{dot}</span></span>
<span id="cb93-433"><a href="#cb93-433" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-width: 2</span></span>
<span id="cb93-434"><a href="#cb93-434" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-height: 2</span></span>
<span id="cb93-435"><a href="#cb93-435" aria-hidden="true" tabindex="-1"></a><span class="in">digraph P {</span></span>
<span id="cb93-436"><a href="#cb93-436" aria-hidden="true" tabindex="-1"></a><span class="in">    {rank=same; smoke -&gt; low;}</span></span>
<span id="cb93-437"><a href="#cb93-437" aria-hidden="true" tabindex="-1"></a><span class="in">    race -&gt; smoke;</span></span>
<span id="cb93-438"><a href="#cb93-438" aria-hidden="true" tabindex="-1"></a><span class="in">    race -&gt; low;   </span></span>
<span id="cb93-439"><a href="#cb93-439" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb93-440"><a href="#cb93-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb93-441"><a href="#cb93-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-442"><a href="#cb93-442" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Application to $Q$</span>
<span id="cb93-443"><a href="#cb93-443" aria-hidden="true" tabindex="-1"></a><span class="ss">  1. </span>seeing <span class="in">`race`</span> as a proxy for culture, association with <span class="in">`smoke`</span> seems at least possible, <span class="in">`race`</span> is certainly not on the causal pathway <span class="in">`smoke`</span> $\rightarrow$ <span class="in">`low`</span></span>
<span id="cb93-444"><a href="#cb93-444" aria-hidden="true" tabindex="-1"></a>  2.</span>
<span id="cb93-445"><a href="#cb93-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-446"><a href="#cb93-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### In R</span></span>
<span id="cb93-447"><a href="#cb93-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-448"><a href="#cb93-448" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check association between `race` and `smoke`</span></span>
<span id="cb93-449"><a href="#cb93-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-450"><a href="#cb93-450" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot</span>
<span id="cb93-453"><a href="#cb93-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-454"><a href="#cb93-454" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">table</span>(race, smoke))</span>
<span id="cb93-455"><a href="#cb93-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-456"><a href="#cb93-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-457"><a href="#cb93-457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Proportion table</span>
<span id="cb93-460"><a href="#cb93-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-461"><a href="#cb93-461" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(race, smoke), <span class="at">margin =</span> <span class="st">'race'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-462"><a href="#cb93-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>) </span>
<span id="cb93-463"><a href="#cb93-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-464"><a href="#cb93-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-465"><a href="#cb93-465" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\chi^2$ test</span>
<span id="cb93-466"><a href="#cb93-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-469"><a href="#cb93-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-470"><a href="#cb93-470" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(race, smoke)</span>
<span id="cb93-471"><a href="#cb93-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-472"><a href="#cb93-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-473"><a href="#cb93-473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Univariate logistic model</span>
<span id="cb93-474"><a href="#cb93-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-477"><a href="#cb93-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-478"><a href="#cb93-478" aria-hidden="true" tabindex="-1"></a>conf_mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(smoke <span class="sc">~</span> race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-479"><a href="#cb93-479" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(conf_mod)</span>
<span id="cb93-480"><a href="#cb93-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-483"><a href="#cb93-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-484"><a href="#cb93-484" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">confint</span>(conf_mod)),<span class="dv">3</span>)</span>
<span id="cb93-485"><a href="#cb93-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-486"><a href="#cb93-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-487"><a href="#cb93-487" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check association between `race` and `low`</span></span>
<span id="cb93-488"><a href="#cb93-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-489"><a href="#cb93-489" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot</span>
<span id="cb93-492"><a href="#cb93-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-493"><a href="#cb93-493" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">table</span>(race, low))</span>
<span id="cb93-494"><a href="#cb93-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-495"><a href="#cb93-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-496"><a href="#cb93-496" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Proportion table</span>
<span id="cb93-499"><a href="#cb93-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-500"><a href="#cb93-500" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(race, low), <span class="at">margin =</span> <span class="st">'race'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-501"><a href="#cb93-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb93-502"><a href="#cb93-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-503"><a href="#cb93-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-504"><a href="#cb93-504" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\chi^2$ test</span>
<span id="cb93-505"><a href="#cb93-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-508"><a href="#cb93-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-509"><a href="#cb93-509" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(race, low)</span>
<span id="cb93-510"><a href="#cb93-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-511"><a href="#cb93-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-512"><a href="#cb93-512" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Univariate logistic model</span>
<span id="cb93-513"><a href="#cb93-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-516"><a href="#cb93-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-517"><a href="#cb93-517" aria-hidden="true" tabindex="-1"></a>conf_mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-518"><a href="#cb93-518" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(conf_mod)</span>
<span id="cb93-519"><a href="#cb93-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-522"><a href="#cb93-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-523"><a href="#cb93-523" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">confint</span>(conf_mod)),<span class="dv">3</span>)</span>
<span id="cb93-524"><a href="#cb93-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-525"><a href="#cb93-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-526"><a href="#cb93-526" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Adjusting for `race`</span></span>
<span id="cb93-527"><a href="#cb93-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-530"><a href="#cb93-530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-531"><a href="#cb93-531" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb93-532"><a href="#cb93-532" aria-hidden="true" tabindex="-1"></a>or_crude <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">OddsRatio</span>(<span class="fu">table</span>(smoke, low), <span class="at">conf.level =</span> .<span class="dv">95</span>),<span class="dv">3</span>)</span>
<span id="cb93-533"><a href="#cb93-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-534"><a href="#cb93-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-535"><a href="#cb93-535" aria-hidden="true" tabindex="-1"></a>The marginal (unadjusted) $OR_{smoke} = <span class="in">`r or_crude['odds ratio']`</span>$ $\left<span class="co">[</span><span class="ot">`r or_crude['lwr.ci']` - `r or_crude['upr.ci']` \right</span><span class="co">]</span>$</span>
<span id="cb93-536"><a href="#cb93-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-537"><a href="#cb93-537" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Marginal $\chi^2$ test</span>
<span id="cb93-540"><a href="#cb93-540" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-541"><a href="#cb93-541" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(smoke, low)</span>
<span id="cb93-542"><a href="#cb93-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-543"><a href="#cb93-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-544"><a href="#cb93-544" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Stratification</span></span>
<span id="cb93-545"><a href="#cb93-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-546"><a href="#cb93-546" aria-hidden="true" tabindex="-1"></a>**1.** Construct the 2x2xk table for <span class="in">`smoke`</span> x <span class="in">`low`</span> x <span class="in">`race`</span></span>
<span id="cb93-549"><a href="#cb93-549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-550"><a href="#cb93-550" aria-hidden="true" tabindex="-1"></a>ptt <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> smoke <span class="sc">+</span> low <span class="sc">+</span> race)</span>
<span id="cb93-551"><a href="#cb93-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-552"><a href="#cb93-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-553"><a href="#cb93-553" aria-hidden="true" tabindex="-1"></a>**2.** Test for effect modification</span>
<span id="cb93-554"><a href="#cb93-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-555"><a href="#cb93-555" aria-hidden="true" tabindex="-1"></a>**2.1** Woolf test for Homogeneity of $\ln OR$ accross strata</span>
<span id="cb93-558"><a href="#cb93-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-559"><a href="#cb93-559" aria-hidden="true" tabindex="-1"></a><span class="fu">WoolfTest</span>(ptt)</span>
<span id="cb93-560"><a href="#cb93-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-561"><a href="#cb93-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-562"><a href="#cb93-562" aria-hidden="true" tabindex="-1"></a>**2.2** Breslow-Day test for Homogeneity of $OR$ accross strata</span>
<span id="cb93-565"><a href="#cb93-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-566"><a href="#cb93-566" aria-hidden="true" tabindex="-1"></a><span class="fu">BreslowDayTest</span>(ptt)</span>
<span id="cb93-567"><a href="#cb93-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-568"><a href="#cb93-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-569"><a href="#cb93-569" aria-hidden="true" tabindex="-1"></a>**3.** Mantel-Haenszel estimate of the adjusted common $OR$</span>
<span id="cb93-570"><a href="#cb93-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-571"><a href="#cb93-571" aria-hidden="true" tabindex="-1"></a>As the tests for effect modification are both $n.s.$, the Mantel-Hanszel-test can be applied. It tests the hypothesis that $OR_k = 1$ accross all $k$ strata of the variable that is adjusted for.</span>
<span id="cb93-572"><a href="#cb93-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-575"><a href="#cb93-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-576"><a href="#cb93-576" aria-hidden="true" tabindex="-1"></a>mh <span class="ot">&lt;-</span> <span class="fu">mantelhaen.test</span>(ptt)</span>
<span id="cb93-577"><a href="#cb93-577" aria-hidden="true" tabindex="-1"></a>mh</span>
<span id="cb93-578"><a href="#cb93-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-579"><a href="#cb93-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-580"><a href="#cb93-580" aria-hidden="true" tabindex="-1"></a>With $p = <span class="in">`r round(mh$p.value, 4)`</span>$ from the MH-test, the data provides sufficient evidence to reject $H_0$ of $OR_{adj} = 1$.  </span>
<span id="cb93-581"><a href="#cb93-581" aria-hidden="true" tabindex="-1"></a>The MH estimate of the true common $OR = <span class="in">`r round(mh$estimate,3)`</span>$ is <span class="in">`r round(mh$estimate / or_crude['odds ratio'], 3)`</span> times the crude estimation of the odds ratio, the <span class="in">`race`</span> variable is likely a confounder of the association <span class="in">`smoke`</span> $\rightarrow$ <span class="in">`low`</span>.</span>
<span id="cb93-582"><a href="#cb93-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-583"><a href="#cb93-583" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Multivariate logistic regression model</span></span>
<span id="cb93-584"><a href="#cb93-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-585"><a href="#cb93-585" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Build and examine unadjusted model</span>
<span id="cb93-588"><a href="#cb93-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-589"><a href="#cb93-589" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-590"><a href="#cb93-590" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span>
<span id="cb93-591"><a href="#cb93-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-592"><a href="#cb93-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-593"><a href="#cb93-593" aria-hidden="true" tabindex="-1"></a>Unadjusted estimate of $OR_{smoke} = <span class="in">`r exp(coef(model1)['smoke1'])`</span>$</span>
<span id="cb93-594"><a href="#cb93-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-595"><a href="#cb93-595" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adjusting for <span class="in">`race`</span></span>
<span id="cb93-598"><a href="#cb93-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-599"><a href="#cb93-599" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-600"><a href="#cb93-600" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span>
<span id="cb93-601"><a href="#cb93-601" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-602"><a href="#cb93-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-603"><a href="#cb93-603" aria-hidden="true" tabindex="-1"></a>Adjusted estimate of $OR_{smoke} = <span class="in">`r exp(coef(model2)['smoke1'])`</span>$</span>
<span id="cb93-604"><a href="#cb93-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-605"><a href="#cb93-605" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mediating variables</span></span>
<span id="cb93-606"><a href="#cb93-606" aria-hidden="true" tabindex="-1"></a><span class="fu">### Concepts</span></span>
<span id="cb93-607"><a href="#cb93-607" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Criteria for a mediating variable $F$</span>
<span id="cb93-608"><a href="#cb93-608" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Do these association conceptually make sense ? :</span>
<span id="cb93-609"><a href="#cb93-609" aria-hidden="true" tabindex="-1"></a><span class="ss">    1. </span>Is $F$ associated with $E$ ? IS $F$ on the pathway $E \rightarrow Y$?</span>
<span id="cb93-610"><a href="#cb93-610" aria-hidden="true" tabindex="-1"></a><span class="ss">    2. </span>Is $F$ associated with $Y$ ?</span>
<span id="cb93-611"><a href="#cb93-611" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Does including $F$ significantly change $b_1$ while not inflating $\sigma_b$ ?</span>
<span id="cb93-612"><a href="#cb93-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-613"><a href="#cb93-613" aria-hidden="true" tabindex="-1"></a>Numerically, mediating variables behave the same way as confounders which gives a crucial role to conceptual assessment when considering whether or not to include the variable in the final model.</span>
<span id="cb93-614"><a href="#cb93-614" aria-hidden="true" tabindex="-1"></a>When building effect size models, usually mediating variables are not included as they would "scrape off" a fraction of the effect size of the variable of interest</span>
<span id="cb93-615"><a href="#cb93-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-616"><a href="#cb93-616" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example</span></span>
<span id="cb93-617"><a href="#cb93-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-618"><a href="#cb93-618" aria-hidden="true" tabindex="-1"></a>$Q$: Does previous premature labour <span class="in">`ptl`</span> mediate the effect of <span class="in">`smoke`</span> on <span class="in">`low`</span>?</span>
<span id="cb93-619"><a href="#cb93-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-622"><a href="#cb93-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{dot}</span></span>
<span id="cb93-623"><a href="#cb93-623" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-width: 2</span></span>
<span id="cb93-624"><a href="#cb93-624" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-height: 2</span></span>
<span id="cb93-625"><a href="#cb93-625" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-align: center</span></span>
<span id="cb93-626"><a href="#cb93-626" aria-hidden="true" tabindex="-1"></a><span class="in">digraph P {</span></span>
<span id="cb93-627"><a href="#cb93-627" aria-hidden="true" tabindex="-1"></a><span class="in">    {rank=same; smoke -&gt; ptl;}</span></span>
<span id="cb93-628"><a href="#cb93-628" aria-hidden="true" tabindex="-1"></a><span class="in">    {rank=same; ptl -&gt; low;}</span></span>
<span id="cb93-629"><a href="#cb93-629" aria-hidden="true" tabindex="-1"></a><span class="in">    smoke -&gt; low;   </span></span>
<span id="cb93-630"><a href="#cb93-630" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb93-631"><a href="#cb93-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb93-632"><a href="#cb93-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-633"><a href="#cb93-633" aria-hidden="true" tabindex="-1"></a>**1.** Checking the association of <span class="in">`smoke`</span> and <span class="in">`ptl`</span></span>
<span id="cb93-634"><a href="#cb93-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,filename="Mosaic plot"}</span></span>
<span id="cb93-635"><a href="#cb93-635" aria-hidden="true" tabindex="-1"></a><span class="in">mosaicplot(table(smoke, ptl))</span></span>
<span id="cb93-636"><a href="#cb93-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-637"><a href="#cb93-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-638"><a href="#cb93-638" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="Test"}</span></span>
<span id="cb93-639"><a href="#cb93-639" aria-hidden="true" tabindex="-1"></a><span class="in">chisq.test(smoke, ptl)</span></span>
<span id="cb93-640"><a href="#cb93-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-641"><a href="#cb93-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-642"><a href="#cb93-642" aria-hidden="true" tabindex="-1"></a>**2.** Checking the association of <span class="in">`ptl`</span> and <span class="in">`low`</span></span>
<span id="cb93-643"><a href="#cb93-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,filename="Mosaic plot"}</span></span>
<span id="cb93-644"><a href="#cb93-644" aria-hidden="true" tabindex="-1"></a><span class="in">mosaicplot(table(ptl, low))</span></span>
<span id="cb93-645"><a href="#cb93-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-646"><a href="#cb93-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-647"><a href="#cb93-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="Test"}</span></span>
<span id="cb93-648"><a href="#cb93-648" aria-hidden="true" tabindex="-1"></a><span class="in">chisq.test(ptl, low)</span></span>
<span id="cb93-649"><a href="#cb93-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-650"><a href="#cb93-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-651"><a href="#cb93-651" aria-hidden="true" tabindex="-1"></a>**3.** Comparing model w/o and with mediating variable</span>
<span id="cb93-652"><a href="#cb93-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-655"><a href="#cb93-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-656"><a href="#cb93-656" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-657"><a href="#cb93-657" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> ptl, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-658"><a href="#cb93-658" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model1); <span class="fu">coef</span>(model2)</span>
<span id="cb93-659"><a href="#cb93-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-660"><a href="#cb93-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-661"><a href="#cb93-661" aria-hidden="true" tabindex="-1"></a>As expected, the coefficient of <span class="in">`smoke`</span> in presence of the <span class="in">`ptl`</span> variable is decreased (same as for a confounding variable). Based on the causal considerations, <span class="in">`ptl`</span> is identified as a mediating factor and would not be included in an effect size model for <span class="in">`smoke`</span>.</span>
<span id="cb93-662"><a href="#cb93-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-663"><a href="#cb93-663" aria-hidden="true" tabindex="-1"></a><span class="fu">## Likelihood-Ratio-Test (LRT)</span></span>
<span id="cb93-664"><a href="#cb93-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-665"><a href="#cb93-665" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nested models</span></span>
<span id="cb93-666"><a href="#cb93-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-667"><a href="#cb93-667" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fit reduced and full model</span></span>
<span id="cb93-670"><a href="#cb93-670" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-671"><a href="#cb93-671" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-672"><a href="#cb93-672" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> race <span class="sc">+</span> smoke<span class="sc">*</span>race, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-673"><a href="#cb93-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-674"><a href="#cb93-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-675"><a href="#cb93-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-676"><a href="#cb93-676" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Testing model significance</span></span>
<span id="cb93-679"><a href="#cb93-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-680"><a href="#cb93-680" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1, m2, <span class="at">test =</span> <span class="st">"LRT"</span>)</span>
<span id="cb93-681"><a href="#cb93-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-682"><a href="#cb93-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-683"><a href="#cb93-683" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overall model significance</span></span>
<span id="cb93-684"><a href="#cb93-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-685"><a href="#cb93-685" aria-hidden="true" tabindex="-1"></a>Test a given model against a null-model (no coefficients, only intercept, thus just $\hat p$ of the outcome)</span>
<span id="cb93-686"><a href="#cb93-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-689"><a href="#cb93-689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-690"><a href="#cb93-690" aria-hidden="true" tabindex="-1"></a>nullmod <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb93-691"><a href="#cb93-691" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(nullmod, <span class="at">type =</span> <span class="st">'response'</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb93-692"><a href="#cb93-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-693"><a href="#cb93-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-696"><a href="#cb93-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-697"><a href="#cb93-697" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(nullmod, m1, <span class="at">test=</span><span class="st">'LRT'</span>)</span>
<span id="cb93-698"><a href="#cb93-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-699"><a href="#cb93-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-700"><a href="#cb93-700" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect modification and Interaction</span></span>
<span id="cb93-701"><a href="#cb93-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-702"><a href="#cb93-702" aria-hidden="true" tabindex="-1"></a><span class="fu">### Concepts</span></span>
<span id="cb93-703"><a href="#cb93-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-706"><a href="#cb93-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{dot}</span></span>
<span id="cb93-707"><a href="#cb93-707" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-width: 3</span></span>
<span id="cb93-708"><a href="#cb93-708" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-height: 3</span></span>
<span id="cb93-709"><a href="#cb93-709" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-align: center</span></span>
<span id="cb93-710"><a href="#cb93-710" aria-hidden="true" tabindex="-1"></a><span class="in">digraph P {</span></span>
<span id="cb93-711"><a href="#cb93-711" aria-hidden="true" tabindex="-1"></a><span class="in">    rankdir=LR</span></span>
<span id="cb93-712"><a href="#cb93-712" aria-hidden="true" tabindex="-1"></a><span class="in">    X1</span></span>
<span id="cb93-713"><a href="#cb93-713" aria-hidden="true" tabindex="-1"></a><span class="in">    F</span></span>
<span id="cb93-714"><a href="#cb93-714" aria-hidden="true" tabindex="-1"></a><span class="in">    Int [fontsize=0, width=0.05, height=0.05, shape=square, fixedsize=true, fillcolor="black", style=filled]</span></span>
<span id="cb93-715"><a href="#cb93-715" aria-hidden="true" tabindex="-1"></a><span class="in">    Y</span></span>
<span id="cb93-716"><a href="#cb93-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-717"><a href="#cb93-717" aria-hidden="true" tabindex="-1"></a><span class="in">  X1 -&gt; Int;</span></span>
<span id="cb93-718"><a href="#cb93-718" aria-hidden="true" tabindex="-1"></a><span class="in">  F -&gt; Int;</span></span>
<span id="cb93-719"><a href="#cb93-719" aria-hidden="true" tabindex="-1"></a><span class="in">  Int -&gt; Y</span></span>
<span id="cb93-720"><a href="#cb93-720" aria-hidden="true" tabindex="-1"></a><span class="in">  Int -&gt; Y</span></span>
<span id="cb93-721"><a href="#cb93-721" aria-hidden="true" tabindex="-1"></a><span class="in">  Int -&gt; Y</span></span>
<span id="cb93-722"><a href="#cb93-722" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb93-723"><a href="#cb93-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb93-724"><a href="#cb93-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-725"><a href="#cb93-725" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Does the interaction conceptually make sense ?</span>
<span id="cb93-726"><a href="#cb93-726" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Is $X2$ **NOT** on the pathway $X1 \rightarrow Y$?</span>
<span id="cb93-727"><a href="#cb93-727" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The interaction is statistically significant.</span>
<span id="cb93-728"><a href="#cb93-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-729"><a href="#cb93-729" aria-hidden="true" tabindex="-1"></a>Mathematically: $OR_{F_i} \not = OR_{F_j}$</span>
<span id="cb93-730"><a href="#cb93-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-731"><a href="#cb93-731" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example</span></span>
<span id="cb93-732"><a href="#cb93-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-733"><a href="#cb93-733" aria-hidden="true" tabindex="-1"></a>$Q$: Does <span class="in">`race`</span> modify the effect of <span class="in">`smoke`</span> on <span class="in">`low`</span>?</span>
<span id="cb93-734"><a href="#cb93-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-735"><a href="#cb93-735" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>It is known for other exposures, that race is an effect modifier</span>
<span id="cb93-736"><a href="#cb93-736" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="in">`smoke`</span> does certainly not influence <span class="in">`race`</span></span>
<span id="cb93-737"><a href="#cb93-737" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>TBD</span>
<span id="cb93-738"><a href="#cb93-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-739"><a href="#cb93-739" aria-hidden="true" tabindex="-1"></a>If <span class="in">`race`</span> is an effect modifier, an $OR$ for the impact of <span class="in">`smoke`</span> for each level of <span class="in">`race`</span> has to be determined:</span>
<span id="cb93-740"><a href="#cb93-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-741"><a href="#cb93-741" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$OR_{white}$</span>
<span id="cb93-742"><a href="#cb93-742" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$OR_{black}$</span>
<span id="cb93-743"><a href="#cb93-743" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$OR_{other}$</span>
<span id="cb93-744"><a href="#cb93-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-747"><a href="#cb93-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-748"><a href="#cb93-748" aria-hidden="true" tabindex="-1"></a>intmod <span class="ot">&lt;-</span> <span class="fu">glm</span>(low <span class="sc">~</span> smoke <span class="sc">+</span> race <span class="sc">+</span> smoke<span class="sc">*</span>race, <span class="at">family=</span><span class="st">'binomial'</span>,</span>
<span id="cb93-749"><a href="#cb93-749" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> lbw)</span>
<span id="cb93-750"><a href="#cb93-750" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(intmod)</span>
<span id="cb93-751"><a href="#cb93-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-752"><a href="#cb93-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-755"><a href="#cb93-755" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-756"><a href="#cb93-756" aria-hidden="true" tabindex="-1"></a>cs <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(intmod<span class="sc">$</span>coefficients), <span class="dv">3</span>)</span>
<span id="cb93-757"><a href="#cb93-757" aria-hidden="true" tabindex="-1"></a>cs_int <span class="ot">&lt;-</span> <span class="fu">confint</span>(intmod) <span class="sc">%&gt;%</span></span>
<span id="cb93-758"><a href="#cb93-758" aria-hidden="true" tabindex="-1"></a>            <span class="fu">exp</span>() <span class="sc">%&gt;%</span></span>
<span id="cb93-759"><a href="#cb93-759" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb93-760"><a href="#cb93-760" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(cs, cs_int)            </span>
<span id="cb93-761"><a href="#cb93-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-762"><a href="#cb93-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-763"><a href="#cb93-763" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Equation with fitted model parameters</span>
<span id="cb93-764"><a href="#cb93-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-765"><a href="#cb93-765" aria-hidden="true" tabindex="-1"></a><span class="in">`r extract_eq(intmod, wrap = T, use_coefs=T)`</span></span>
<span id="cb93-766"><a href="#cb93-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-767"><a href="#cb93-767" aria-hidden="true" tabindex="-1"></a>The coefficient for an exposure $E$ for a given level of an effect modifier $F$ is given by</span>
<span id="cb93-768"><a href="#cb93-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-769"><a href="#cb93-769" aria-hidden="true" tabindex="-1"></a>$$\beta_E + \beta_{E \times F=k}$$</span>
<span id="cb93-770"><a href="#cb93-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-771"><a href="#cb93-771" aria-hidden="true" tabindex="-1"></a>Therefore</span>
<span id="cb93-772"><a href="#cb93-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-773"><a href="#cb93-773" aria-hidden="true" tabindex="-1"></a>$$OR_{smoke} \text{ by race }= e^{\beta_{smoke}+\sum_i^k \beta_{smoke \times k}I_k}$$</span>
<span id="cb93-774"><a href="#cb93-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-775"><a href="#cb93-775" aria-hidden="true" tabindex="-1"></a>| $F$ <span class="in">`race`</span>  | $OR_{F=k}$  |</span>
<span id="cb93-776"><a href="#cb93-776" aria-hidden="true" tabindex="-1"></a>|-------------+-------------|</span>
<span id="cb93-777"><a href="#cb93-777" aria-hidden="true" tabindex="-1"></a>| white (rev) | <span class="in">`r round(exp(1.75),2)`</span>|</span>
<span id="cb93-778"><a href="#cb93-778" aria-hidden="true" tabindex="-1"></a>| black (race2)| <span class="in">`r round(exp(1.75 - 0.56),2)`</span>|</span>
<span id="cb93-779"><a href="#cb93-779" aria-hidden="true" tabindex="-1"></a>| other (race3)| <span class="in">`r round(exp(1.75 - 1.53),2)`</span>|</span>
<span id="cb93-780"><a href="#cb93-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-781"><a href="#cb93-781" aria-hidden="true" tabindex="-1"></a>The statistical significance can be determined also by a likelihood-ratio test.</span>
<span id="cb93-782"><a href="#cb93-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-783"><a href="#cb93-783" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model assumptions</span></span>
<span id="cb93-784"><a href="#cb93-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-785"><a href="#cb93-785" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Linearity of $X \sim \ln odds$, needs to be checked</span>
<span id="cb93-786"><a href="#cb93-786" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Independent $Y$ values, determined by study design</span>
<span id="cb93-787"><a href="#cb93-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-788"><a href="#cb93-788" aria-hidden="true" tabindex="-1"></a>The following are assumed/true given the structure of the data</span>
<span id="cb93-789"><a href="#cb93-789" aria-hidden="true" tabindex="-1"></a>(in contrary to linear regression where normality assumptions needs to be verified)</span>
<span id="cb93-790"><a href="#cb93-790" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Errors are binomially distributed</span>
<span id="cb93-791"><a href="#cb93-791" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Variance depends on $p$</span>
<span id="cb93-792"><a href="#cb93-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-793"><a href="#cb93-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-794"><a href="#cb93-794" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linearity check</span></span>
<span id="cb93-795"><a href="#cb93-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-796"><a href="#cb93-796" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>only necessary for numeric variables</span>
<span id="cb93-797"><a href="#cb93-797" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>quantise into 3-5 (based on quantiles) groups</span>
<span id="cb93-798"><a href="#cb93-798" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>estimate $\hat p = <span class="sc">\{</span>\hat p_1, \ldots , \hat p_k <span class="sc">\}</span>$</span>
<span id="cb93-799"><a href="#cb93-799" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>calculate $\forall k: \operatorname{Logit}(\hat p_k)$</span>
<span id="cb93-800"><a href="#cb93-800" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>plot results against median (robust wrt outliers) of groups</span>
<span id="cb93-801"><a href="#cb93-801" aria-hidden="true" tabindex="-1"></a>$\Rightarrow$ Line ?</span>
<span id="cb93-802"><a href="#cb93-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-803"><a href="#cb93-803" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example using `lwt`</span></span>
<span id="cb93-804"><a href="#cb93-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-805"><a href="#cb93-805" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="Outcome probabilities by Quantiles"}</span></span>
<span id="cb93-806"><a href="#cb93-806" aria-hidden="true" tabindex="-1"></a><span class="in">lbw$lwtcat &lt;- cut(lwt, breaks = quantile(lwt, c(0, 0.25, 0.5, 0.75, 1)),</span></span>
<span id="cb93-807"><a href="#cb93-807" aria-hidden="true" tabindex="-1"></a><span class="in">                include.lowest=T, right=F)</span></span>
<span id="cb93-808"><a href="#cb93-808" aria-hidden="true" tabindex="-1"></a><span class="in">ps &lt;- table(lbw$lwtcat,</span></span>
<span id="cb93-809"><a href="#cb93-809" aria-hidden="true" tabindex="-1"></a><span class="in">             low) %&gt;%</span></span>
<span id="cb93-810"><a href="#cb93-810" aria-hidden="true" tabindex="-1"></a><span class="in">        prop.table(margin = 1)</span></span>
<span id="cb93-811"><a href="#cb93-811" aria-hidden="true" tabindex="-1"></a><span class="in">ps        </span></span>
<span id="cb93-812"><a href="#cb93-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-813"><a href="#cb93-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-814"><a href="#cb93-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="log odds"}</span></span>
<span id="cb93-815"><a href="#cb93-815" aria-hidden="true" tabindex="-1"></a><span class="in">logodds &lt;- log(ps[,2]/ps[,1])</span></span>
<span id="cb93-816"><a href="#cb93-816" aria-hidden="true" tabindex="-1"></a><span class="in">logodds</span></span>
<span id="cb93-817"><a href="#cb93-817" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-818"><a href="#cb93-818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="Plot against group medians"}</span></span>
<span id="cb93-819"><a href="#cb93-819" aria-hidden="true" tabindex="-1"></a><span class="in">medians &lt;- lbw %&gt;% group_by(lwtcat) %&gt;%</span></span>
<span id="cb93-820"><a href="#cb93-820" aria-hidden="true" tabindex="-1"></a><span class="in">                   summarise(med = median(lwt))</span></span>
<span id="cb93-821"><a href="#cb93-821" aria-hidden="true" tabindex="-1"></a><span class="in">plot(medians$med, logodds)</span></span>
<span id="cb93-822"><a href="#cb93-822" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-823"><a href="#cb93-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-824"><a href="#cb93-824" aria-hidden="true" tabindex="-1"></a>From the plot it seems that there is no linear relationship between <span class="in">`lwt`</span> and <span class="in">`low`</span>. Based on the information obtained, a new dichotomous variable will be created <span class="in">`lwd`</span>, with </span>
<span id="cb93-825"><a href="#cb93-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-826"><a href="#cb93-826" aria-hidden="true" tabindex="-1"></a>$$lwd = </span>
<span id="cb93-827"><a href="#cb93-827" aria-hidden="true" tabindex="-1"></a>\begin{cases}</span>
<span id="cb93-828"><a href="#cb93-828" aria-hidden="true" tabindex="-1"></a>1 \quad \mid lwt&lt;110<span class="sc">\\</span></span>
<span id="cb93-829"><a href="#cb93-829" aria-hidden="true" tabindex="-1"></a>0 \quad \mid lwt \geq 110</span>
<span id="cb93-830"><a href="#cb93-830" aria-hidden="true" tabindex="-1"></a>\end{cases}$$</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>